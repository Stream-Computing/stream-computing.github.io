"use strict";(self.webpackChunkstc_docuhub=self.webpackChunkstc_docuhub||[]).push([[6798],{26:(n,e,s)=>{s.d(e,{A:()=>t});const t=s.p+"assets/images/stc-llm-image-2-c4a872030cd9a65231abadb517ce0780.png"},460:(n,e,s)=>{s.d(e,{A:()=>t});const t=s.p+"assets/images/stc-llm-image-4-fac2c22d70b1848d8411470776583a5b.png"},476:(n,e,s)=>{s.d(e,{A:()=>t});const t=s.p+"assets/images/stc-llm-image-11-190c1ce8e36134a69200454f25960323.png"},1083:(n,e,s)=>{s.d(e,{A:()=>t});const t=s.p+"assets/images/img_v3_02cq_5186f449-e627-4ad0-a098-8bdf2e93bafg-2b6b8152a3a40f68906d423596ae6508.jpg"},1710:(n,e,s)=>{s.d(e,{A:()=>t});const t=s.p+"assets/images/stc-llm-image-6-83382ebe46319483353cd7b5c40e8bff.png"},2085:(n,e,s)=>{s.d(e,{A:()=>t});const t=s.p+"assets/images/stc-llm-image-5-7590355785434bbe6855bb316566ebde.png"},2305:(n,e,s)=>{s.d(e,{A:()=>t});const t=s.p+"assets/images/stc-llm-image-14-5b99a4172b514d915afa16adc9499b85.png"},2608:(n,e,s)=>{s.r(e),s.d(e,{assets:()=>d,contentTitle:()=>c,default:()=>o,frontMatter:()=>i,metadata:()=>t,toc:()=>a});const t=JSON.parse('{"id":"\u63a8\u7406\u8f6f\u4ef6\u4f7f\u7528\u624b\u518c/STCRP\u4f7f\u7528\u6307\u5357/STC_LLM\u4f7f\u7528\u6307\u5357","title":"STC_LLM\u4f7f\u7528\u6307\u5357","description":"STC_LLM\u6982\u8ff0","source":"@site/docs/\u63a8\u7406\u8f6f\u4ef6\u4f7f\u7528\u624b\u518c/STCRP\u4f7f\u7528\u6307\u5357/STC_LLM\u4f7f\u7528\u6307\u5357.md","sourceDirName":"\u63a8\u7406\u8f6f\u4ef6\u4f7f\u7528\u624b\u518c/STCRP\u4f7f\u7528\u6307\u5357","slug":"/\u63a8\u7406\u8f6f\u4ef6\u4f7f\u7528\u624b\u518c/STCRP\u4f7f\u7528\u6307\u5357/STC_LLM\u4f7f\u7528\u6307\u5357","permalink":"/docs/\u63a8\u7406\u8f6f\u4ef6\u4f7f\u7528\u624b\u518c/STCRP\u4f7f\u7528\u6307\u5357/STC_LLM\u4f7f\u7528\u6307\u5357","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/\u63a8\u7406\u8f6f\u4ef6\u4f7f\u7528\u624b\u518c/STCRP\u4f7f\u7528\u6307\u5357/STC_LLM\u4f7f\u7528\u6307\u5357.md","tags":[],"version":"current","sidebarPosition":3,"frontMatter":{"sidebar_position":3,"sidebar_label":"STC_LLM\u4f7f\u7528\u6307\u5357","sidebar_class_name":"green"},"sidebar":"tutorialSidebar","previous":{"title":"MLTC\u4f7f\u7528\u6307\u5357","permalink":"/docs/\u63a8\u7406\u8f6f\u4ef6\u4f7f\u7528\u624b\u518c/STCRP\u4f7f\u7528\u6307\u5357/MLTC\u4f7f\u7528\u6307\u5357"},"next":{"title":"\u7b97\u529b\u670d\u52a1\u89e3\u51b3\u65b9\u6848","permalink":"/docs/category/\u7b97\u529b\u670d\u52a1\u89e3\u51b3\u65b9\u6848"}}');var r=s(4848),l=s(8453);const i={sidebar_position:3,sidebar_label:"STC_LLM\u4f7f\u7528\u6307\u5357",sidebar_class_name:"green"},c="STC_LLM\u4f7f\u7528\u6307\u5357",d={},a=[{value:"STC_LLM\u6982\u8ff0",id:"stc_llm\u6982\u8ff0",level:2},{value:"\u524d\u63d0\u6761\u4ef6",id:"\u524d\u63d0\u6761\u4ef6",level:2},{value:"\u63d0\u4f9b\u63a8\u7406\u670d\u52a1",id:"\u63d0\u4f9b\u63a8\u7406\u670d\u52a1",level:2},{value:"\u670d\u52a1\u7aef\u542f\u52a8\u63a8\u7406\u670d\u52a1",id:"\u670d\u52a1\u7aef\u542f\u52a8\u63a8\u7406\u670d\u52a1",level:3},{value:"\u51c6\u5907\u6a21\u578b",id:"\u51c6\u5907\u6a21\u578b",level:4},{value:"\u542f\u52a8\u63a8\u7406\u670d\u52a1",id:"\u542f\u52a8\u63a8\u7406\u670d\u52a1",level:4},{value:"\u914d\u7f6e\u9879\u8bf4\u660e",id:"\u914d\u7f6e\u9879\u8bf4\u660e",level:4},{value:"\u5ba2\u6237\u7aef\u53d1\u8d77\u63a8\u7406\u8bf7\u6c42",id:"\u5ba2\u6237\u7aef\u53d1\u8d77\u63a8\u7406\u8bf7\u6c42",level:3},{value:"\u53d1\u8d77\u63a8\u7406\u8bf7\u6c42",id:"\u53d1\u8d77\u63a8\u7406\u8bf7\u6c42",level:4},{value:"completions\u53c2\u6570",id:"completions\u53c2\u6570",level:4},{value:"chat_completions\u53c2\u6570",id:"chat_completions\u53c2\u6570",level:4},{value:"\u76d1\u63a7\u63a8\u7406\u6307\u6807",id:"\u76d1\u63a7\u63a8\u7406\u6307\u6807",level:2},{value:"\u524d\u63d0\u6761\u4ef6",id:"\u524d\u63d0\u6761\u4ef6-1",level:3},{value:"\u6307\u6807\u7c7b\u578b",id:"\u6307\u6807\u7c7b\u578b",level:3},{value:"\u670d\u52a1\u7aef\u64cd\u4f5c",id:"\u670d\u52a1\u7aef\u64cd\u4f5c",level:3},{value:"Web\u7aef\u64cd\u4f5c\uff08Prometheus\uff09",id:"web\u7aef\u64cd\u4f5cprometheus",level:3},{value:"Web\u7aef\u64cd\u4f5c\uff08Grafana\uff09",id:"web\u7aef\u64cd\u4f5cgrafana",level:3},{value:"\u767b\u5f55Grafana",id:"\u767b\u5f55grafana",level:4},{value:"\u6dfb\u52a0Prometheus\u6570\u636e\u6e90",id:"\u6dfb\u52a0prometheus\u6570\u636e\u6e90",level:4},{value:"\u521b\u5efaSTC_LLM Dashboard",id:"\u521b\u5efastc_llm-dashboard",level:4},{value:"\u7f16\u8f91Dashboard\u4e2d\u7684Panel",id:"\u7f16\u8f91dashboard\u4e2d\u7684panel",level:4},{value:"\u4e3aDashboard\u6dfb\u52a0\u65b0Panel",id:"\u4e3adashboard\u6dfb\u52a0\u65b0panel",level:4},{value:"\u751f\u6210\u91cf\u5316\u7cfb\u6570",id:"\u751f\u6210\u91cf\u5316\u7cfb\u6570",level:2},{value:"\u672c\u5730\u9a8c\u8bc1\u6a21\u578b",id:"\u672c\u5730\u9a8c\u8bc1\u6a21\u578b",level:2},{value:"\u624b\u5199\u5927\u6a21\u578b",id:"\u624b\u5199\u5927\u6a21\u578b",level:3},{value:"MLTC\u7f16\u8bd1\u5927\u6a21\u578b",id:"mltc\u7f16\u8bd1\u5927\u6a21\u578b",level:3},{value:"\u6a21\u578b\u914d\u7f6e",id:"\u6a21\u578b\u914d\u7f6e",level:3},{value:"\u95ee\u9898\u6392\u67e5",id:"\u95ee\u9898\u6392\u67e5",level:3},{value:"\u672a\u8bbe\u7f6eRISC-V\u73af\u5883\u53d8\u91cf",id:"\u672a\u8bbe\u7f6erisc-v\u73af\u5883\u53d8\u91cf",level:4},{value:"\u53ef\u7528\u5185\u5b58\u4e0d\u8db3",id:"\u53ef\u7528\u5185\u5b58\u4e0d\u8db3",level:4},{value:"\u6295\u673a\u91c7\u6837\u793a\u4f8b",id:"\u6295\u673a\u91c7\u6837\u793a\u4f8b",level:2},{value:"\u95ee\u9898\u6392\u67e5",id:"\u95ee\u9898\u6392\u67e5-1",level:3},{value:"\u53ef\u7528\u5185\u5b58\u4e0d\u8db3",id:"\u53ef\u7528\u5185\u5b58\u4e0d\u8db3-1",level:4}];function h(n){const e={a:"a",blockquote:"blockquote",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,l.R)(),...n.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(e.header,{children:(0,r.jsx)(e.h1,{id:"stc_llm\u4f7f\u7528\u6307\u5357",children:"STC_LLM\u4f7f\u7528\u6307\u5357"})}),"\n",(0,r.jsx)(e.h2,{id:"stc_llm\u6982\u8ff0",children:"STC_LLM\u6982\u8ff0"}),"\n",(0,r.jsx)(e.p,{children:"\u672c\u6587\u6863\u5c06\u6f14\u793a\u5982\u4f55\u57fa\u4e8e\u5e0c\u59c6\u8ba1\u7b97\u8f6f\u786c\u4ef6\u90e8\u7f72LLM\uff0c\u63d0\u4f9b\u63a8\u7406\u670d\u52a1\u3001\u5904\u7406\u63a8\u7406\u4efb\u52a1\u5e76\u76d1\u63a7\u63a8\u7406\u8fc7\u7a0b\u4e2d\u7684\u6307\u6807\u3002"}),"\n",(0,r.jsx)(e.p,{children:"\u4e3b\u6d41\u7684\u5f00\u6e90LLM\u5f80\u5f80\u57fa\u4e8eHuggingFace\u7b49\u683c\u5f0f\uff0c\u6743\u91cd\u4fdd\u5b58\u4e3abin\u6216\u8005safetensors\uff0c\u4e3a\u66f4\u9ad8\u6548\u5730\u5b8c\u6210LLM\u63a8\u7406\u4efb\u52a1\uff0c\u5e0c\u59c6\u8ba1\u7b97\u9762\u5411LLM\u81ea\u7814\u4e86\u63a8\u7406\u6846\u67b6STC_LLM\u3002STC_LLM\u5728AI\u7f16\u8bd1\u5668\u3001\u624b\u5199\u7b97\u5b50\u7684\u57fa\u7840\u4e0a\u5bf9LLM\u7684\u63a8\u7406\u8fc7\u7a0b\u8fdb\u884c\u4e86\u5c01\u88c5\uff0c\u60a8\u53ef\u4ee5\u65b9\u4fbf\u5730\u5bfc\u5165\u3001\u66ff\u6362LLM\u5e76\u5b8c\u6210\u63a8\u7406\u4efb\u52a1\uff0c\u7b80\u5316\u4e86LLM\u7684\u90e8\u7f72\u548c\u4f7f\u7528\u8fc7\u7a0b\u3002"}),"\n",(0,r.jsx)(e.p,{children:"STC_LLM\u9762\u5411LLM\u652f\u6301\u4ee5\u4e0b\u7279\u6027\uff1a"}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsx)(e.p,{children:"\u7f16\u8bd1\u9636\u6bb5\uff1a\u652f\u6301\u6743\u91cd\u8f6c\u6362\u3001\u91cf\u5316\u9884\u5904\u7406\u3001Tensor\u5e76\u884c\u5904\u7406\u8d85\u5927\u89c4\u6a21\u7684\u6743\u91cd\u7b49\u3002"}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsx)(e.p,{children:"\u670d\u52a1\u9636\u6bb5\uff1a\u652f\u6301\u52a8\u6001batch\u7ba1\u7406\u4f18\u5316\u7aef\u5230\u7aef\u541e\u5410\u3002"}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsx)(e.p,{children:"\u63a8\u7406\u9636\u6bb5\uff1a\u652f\u6301kernel\u7ea7\u522b\u7684\u4f18\u5316\u3001KV Cache\u4f18\u5316\u7b49\u3002"}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(e.p,{children:"\u57fa\u4e8eSTC_LLM\u7684\u5178\u578b\u63a8\u7406\u6d41\u7a0b\u5982\u4e0b\u56fe\u6240\u793a\uff1a"}),"\n",(0,r.jsx)(e.p,{children:(0,r.jsx)(e.img,{src:s(5566).A+"",width:"1280",height:"492"})}),"\n",(0,r.jsx)(e.p,{children:"STC_LLM_DNN\u662f\u5927\u6a21\u578b\u901a\u8fc7\u624b\u5199\u7b97\u5b50\u7b49\u7279\u6b8a\u5904\u7406\u7f16\u8bd1\u540e\u90e8\u7f72LLM\u7684\u6846\u67b6\u3002STC_LLM_MLTC\u662f\u5927\u6a21\u578b\u901a\u8fc7MLTC\u7f16\u8bd1\u5668\u7f16\u8bd1\u540e\u90e8\u7f72LLM\u7684\u6846\u67b6\u3002\u76ee\u524d\uff0c\u91c7\u7528STC_LLM_DNN\u6846\u67b6\u8fdb\u884c\u7f16\u8bd1\u90e8\u7f72\u7684\u5927\u6a21\u578b\uff0c\u5728\u63a8\u7406\u73af\u8282\u5c55\u73b0\u51fa\u66f4\u4f18\u7684\u6027\u80fd\u8868\u73b0\u3002"}),"\n",(0,r.jsx)(e.h2,{id:"\u524d\u63d0\u6761\u4ef6",children:"\u524d\u63d0\u6761\u4ef6"}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsx)(e.p,{children:"\u786e\u4fdd\u670d\u52a1\u5668\u7684\u5185\u5b58\u6ee1\u8db3\u6a21\u578b\u7684\u8981\u6c42\uff0c\u5927\u6a21\u578b\u7684HuggingFace\u9879\u76ee\u6587\u4ef6\u90fd\u5f88\u5927\uff0c\u5728\u8f6c\u6362\u6743\u91cd\u65f6\u8fd8\u4f1a\u521b\u5efa\u526f\u672c\uff0c\u56e0\u6b64\u9700\u8981\u914d\u5907\u5c3d\u91cf\u5927\u7684\u5185\u5b58\u3002"}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsx)(e.p,{children:"\u786e\u4fdd\u80fd\u8bbf\u95eeHuggingFace\u7b49\u6e20\u9053\uff0c\u4e14\u53ef\u4ee5\u4e0b\u8f7d\u5e26\u6709LFS\u6807\u8bb0\u7684\u6587\u4ef6\u3002"}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsx)(e.p,{children:"\u51c6\u5907LLM\u63a8\u7406\u73af\u5883\uff0c\u5b89\u88c5HPE\u3001Python V3.10\u3001HPE Python\u3001STC_LLM\u3002"}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsx)(e.p,{children:"\u90e8\u7f72\u624b\u5199\u5927\u6a21\u578b\u65f6\uff0c\u786e\u4fdd\u5df2\u5b89\u88c5STC_LLM_DNN\u3002"}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsx)(e.p,{children:"\u901a\u8fc7MLTC\u7f16\u8bd1\u5668\u7f16\u8bd1\u548c\u90e8\u7f72\u5927\u6a21\u578b\u65f6\uff0c\u786e\u4fdd\u5df2\u5b89\u88c5\u597dSTC_LLM_MLTC\u548cMLTC\u3002"}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(e.blockquote,{children:["\n",(0,r.jsxs)(e.p,{children:["\u8bf4\u660e\uff1a\u5404\u9879\u8f6f\u4ef6\u7684\u5177\u4f53\u64cd\u4f5c\uff0c\u8bf7\u53c2\u89c1",(0,r.jsx)(e.em,{children:"STCRP\u5b89\u88c5\u6307\u5357"}),"\u3002"]}),"\n"]}),"\n",(0,r.jsx)(e.h2,{id:"\u63d0\u4f9b\u63a8\u7406\u670d\u52a1",children:"\u63d0\u4f9b\u63a8\u7406\u670d\u52a1"}),"\n",(0,r.jsx)(e.p,{children:"STC_LLM\u4e2d\u5c01\u88c5\u4e86OpenAI\u98ce\u683c\u7684\u63a5\u53e3\uff0c\u670d\u52a1\u7aef\u53ef\u4ee5\u63d0\u4f9b\u63a8\u7406\u670d\u52a1\u5e76\u5904\u7406\u63a8\u7406\u8bf7\u6c42\uff0c\u5ba2\u6237\u7aef\u901a\u8fc7Python\u811a\u672c\u3001curl\u547d\u4ee4\u7b49\u65b9\u5f0f\u548cLLM\u4ea4\u4e92\u3002\u6211\u4eec\u652f\u6301\u624b\u5199\u5927\u6a21\u578b\u548c\u901a\u8fc7MLTC\u7f16\u8bd1\u5668\u7f16\u8bd1\u5927\u6a21\u578b\uff0c\u4ee5Qwen2-7B-Instruct\u4e3a\u4f8b\u6f14\u793aSTC_LLM\u63d0\u4f9b\u63a8\u7406\u670d\u52a1\u6b65\u9aa4\u3002"}),"\n",(0,r.jsxs)(e.blockquote,{children:["\n",(0,r.jsxs)(e.p,{children:["\u8bf4\u660e\uff1a\u76ee\u524d\u652f\u6301\u7684LLM\u5217\u8868\uff0c\u8bf7\u53c2\u89c1",(0,r.jsx)(e.em,{children:"\u6a21\u578b\u652f\u6301\u8bf4\u660e"}),"\u3002"]}),"\n"]}),"\n",(0,r.jsx)(e.h3,{id:"\u670d\u52a1\u7aef\u542f\u52a8\u63a8\u7406\u670d\u52a1",children:"\u670d\u52a1\u7aef\u542f\u52a8\u63a8\u7406\u670d\u52a1"}),"\n",(0,r.jsx)(e.h4,{id:"\u51c6\u5907\u6a21\u578b",children:"\u51c6\u5907\u6a21\u578b"}),"\n",(0,r.jsxs)(e.ol,{children:["\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsxs)(e.p,{children:["\u4eceHuggingFace\u7b49\u6e20\u9053\u83b7\u53d6",(0,r.jsx)(e.a,{href:"https://huggingface.co/Qwen/Qwen2-7B-Instruct",children:"Qwen2-7B-Instruct"}),"\u6587\u4ef6\uff0c\u5305\u62ec\u6a21\u578b\u6587\u4ef6\u3001\u6743\u91cd\u6587\u4ef6\u3001\u5206\u8bcd\u5668\u6587\u4ef6\u3001\u8bcd\u8868\u7b49\uff0c\u5e76\u590d\u5236\u5230\u76ee\u6807\u670d\u52a1\u5668\u3002"]}),"\n",(0,r.jsx)(e.p,{children:(0,r.jsx)(e.img,{src:s(5815).A+"",width:"1280",height:"694"})}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsxs)(e.p,{children:["\uff08\u53ef\u9009\uff09\u4f7f\u7528SNC\u91cf\u5316\u5de5\u5177\u751f\u6210\u91cf\u5316\u7cfb\u6570\u3002\u8be6\u7ec6\u6b65\u9aa4\u8bf7\u53c2\u89c1",(0,r.jsx)(e.em,{children:"\u751f\u6210\u91cf\u5316\u6a21\u578b"}),"\u7ae0\u8282\u3002"]}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsxs)(e.p,{children:["\uff08\u53ef\u9009\uff09\u5728\u672c\u5730\u9a8c\u8bc1\u5927\u6a21\u578b\u7684\u53ef\u884c\u6027\uff0c\u652f\u6301\u672c\u5730\u9a8c\u8bc1\u624b\u5199\u5927\u6a21\u578b\u548c\u901a\u8fc7MLTC\u7f16\u8bd1\u5668\u7f16\u8bd1\u5927\u6a21\u578b\uff0c\u8be6\u7ec6\u6b65\u9aa4\u8bf7\u53c2\u89c1",(0,r.jsx)(e.em,{children:"\u672c\u5730\u9a8c\u8bc1\u6a21\u578b"}),"\u7ae0\u8282\u3002"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(e.h4,{id:"\u542f\u52a8\u63a8\u7406\u670d\u52a1",children:"\u542f\u52a8\u63a8\u7406\u670d\u52a1"}),"\n",(0,r.jsx)(e.p,{children:"\u6211\u4eec\u652f\u6301\u624b\u5199\u5927\u6a21\u578b\u548cMLTC\u7f16\u8bd1\u5927\u6a21\u578b\uff0c\u5728\u670d\u52a1\u7aef\u542f\u52a8\u63a8\u7406\u670d\u52a1\u65f6\u53ef\u4ee5\u6307\u5b9a\u7f16\u8bd1\u90e8\u7f72\u65b9\u5f0f\u3002"}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsx)(e.p,{children:"\u624b\u5199\u5927\u6a21\u578b\u793a\u4f8b\uff1a"}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsx)(e.p,{children:"\u624b\u52a8\u8f6c\u6362\u6743\u91cd\u5e76\u542f\u52a8\u63a8\u7406\u670d\u52a1\u3002"}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsx)(e.p,{children:"\u624b\u52a8\u8f6c\u6362\u6743\u91cd\u3002"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-Bash",children:"$ python -m stc_llm_dnn.tools.convert_weight \\\n-m Qwen/Qwen2-7B-Instruct \\\n-p /model/Qwen2-7b-Instruct/Qwen2-7B-Instruct \\\n-o /model/Qwen2-7b-Instruct/Qwen2-7B-Instruct_2npu_dataset \\\n-n 2\n"})}),"\n",(0,r.jsx)(e.p,{children:"\u914d\u7f6e\u9009\u9879\u8bf4\u660e\uff1a"}),"\n",(0,r.jsxs)(e.table,{children:[(0,r.jsx)(e.thead,{children:(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.th,{children:(0,r.jsx)(e.strong,{children:"\u53c2\u6570\u9009\u9879"})}),(0,r.jsx)(e.th,{children:(0,r.jsx)(e.strong,{children:"\u63cf\u8ff0"})}),(0,r.jsx)(e.th,{children:(0,r.jsx)(e.strong,{children:"\u662f\u5426\u5fc5\u9009"})})]})}),(0,r.jsxs)(e.tbody,{children:[(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"-m"}),(0,r.jsx)(e.td,{children:"\u6a21\u578b\u5728HuggingFace\u4e0a\u7684ID\u3002"}),(0,r.jsx)(e.td,{children:"\u662f"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"-p"}),(0,r.jsx)(e.td,{children:"\u539f\u59cb\u6743\u91cd\u6240\u5728\u7684\u672c\u5730\u8def\u5f84\u3002"}),(0,r.jsx)(e.td,{children:"\u662f"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"-o"}),(0,r.jsx)(e.td,{children:"\u8f6c\u6362\u540e\u7684NPU\u6743\u91cd\u7684\u5bfc\u51fa\u8def\u5f84\u3002"}),(0,r.jsx)(e.td,{children:"\u662f"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"-n"}),(0,r.jsx)(e.td,{children:"\u6307\u5b9a\u8f6c\u6362\u540e\u7684NPU\u6743\u91cd\u9002\u914d\u7684\u76ee\u6807NPU\u6570\u91cf\uff0c\u5373\u539f\u59cb\u6743\u91cd\u5c06\u88ab\u62c6\u5206\u7684\u4efd\u6570\u3002\u4e3a\u7279\u5b9a\u6570\u91cfNPU\uff08\u59824NPU\uff09\u8f6c\u6362\u7684\u6743\u91cd\uff0c\u65e0\u6cd5\u76f4\u63a5\u7528\u4e8e\u4e0d\u540c\u6570\u91cf\uff08\u59822NPU\uff09\u7684 NPU\u3002"}),(0,r.jsx)(e.td,{children:"\u662f"})]})]})]}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsx)(e.p,{children:"\u542f\u52a8\u63a8\u7406\u670d\u52a1\u3002"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-Bash",children:"$ python -m stc_llm.entrypoints.openai.api_server \\\n--model_name Qwen/Qwen2-7B-Instruct \\\n--tok_dir /model/qwen2-7b-instruct/Qwen2-7B-Instruct \\\n--weight_dir /model/qwen2-7b-instruct/Qwen2-7B-Instruct/2npu/ \\\n--max_tasks 256 \\\n--custom_parameters \\\n--temperature 0.5 \\\n--top_p 0.2 \\\n--top_k 1 \\\n--max_output_len 4096 \\\n--port 8080 \\\n--device 0 1\n"})}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsxs)(e.p,{children:["\u81ea\u52a8\u8f6c\u6362\u6743\u91cd\u5e76\u542f\u52a8\u63a8\u7406\u670d\u52a1\uff0c\u4f7f\u7528",(0,r.jsx)(e.code,{children:"--original_weight_dir"}),"\u539f\u59cb\u6743\u91cd\u3002"]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-Bash",children:"$ python -m stc_llm.entrypoints.openai.api_server \\\n--model_name Qwen/Qwen2-7B-Instruct \\\n--tok_dir /model/qwen2-7b-instruct/Qwen2-7B-Instruct \\\n--original_weight_dir=/model/qwen2-7b-instruct/Qwen2-7B-Instruct \\\n--max_tasks 256 \\\n--custom_parameters \\\n--temperature 0.5 \\\n--top_p 0.2 \\\n--top_k 1 \\\n--max_output_len 4096 \\\n--port 8080 \\\n--device 0 1\n"})}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsx)(e.p,{children:"MLTC\u7f16\u8bd1\u5927\u6a21\u578b\u5e76\u542f\u52a8\u63a8\u7406\u670d\u52a1\uff1a"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-Bash",children:"$ python -m stc_llm.entrypoints.openai.api_server \\\n--model_name Qwen/Qwen2-7B-Instruct \\\n--tok_dir /model/qwen2-7b-instruct \\\n--mltc_weight_dir /model/qwen2-7b-instruct-weight/qwen2-7b-32heads-mask-28layers \\\n--devices 0 1 \\\n--compiler mltc\n\n# \u5ffd\u7565\u90e8\u5206\u56de\u663e\nINFO:     Application startup complete.\nINFO:     Uvicorn running on http://0.0.0.0:18000 (Press CTRL+C to quit)\n"})}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(e.p,{children:["\u5927\u6a21\u578b\u4e5f\u53ef\u4f7f\u7528\u6295\u673a\u91c7\u6837\u65b9\u5f0f\u63d0\u9ad8\u6027\u80fd\u3002\u6295\u673a\u91c7\u6837\u662f\u4e00\u79cd\u9ad8\u6548\u7684\u5927\u6a21\u578b\u63a8\u7406\u4f18\u5316\u7b56\u7565\uff0c\u901a\u8fc7\u8ba9\u540c\u4e00\u7cfb\u5217\u7684\u5c0f\u6a21\u578b\u9884\u5148\u751f\u6210\u591a\u4e2atoken\uff0c\u518d\u6709\u5927\u6a21\u578b\u6279\u91cf\u9a8c\u8bc1\u7684\u65b9\u5f0f\u3002\u5b83\u5de7\u5999\u5730\u878d\u5408\u4e86\u5c0f\u6a21\u578b\u5feb\u901f\u751f\u6210token\u7684\u4f18\u52bf\u4ee5\u53ca\u5927\u6a21\u578b\u7cbe\u51c6\u8bc4\u4f30token\u7684\u80fd\u529b\uff0c\u4ece\u800c\u5728\u63d0\u5347\u81ea\u56de\u5f52\u8bed\u8a00\u6a21\u578b\u63a8\u7406\u901f\u5ea6\u7684\u540c\u65f6\uff0c\u786e\u4fdd\u4e86\u751f\u6210\u7ed3\u679c\u7684\u9ad8\u8d28\u91cf\u3002\u5177\u4f53\u793a\u4f8b\u53ef\u53c2\u89c1",(0,r.jsx)(e.em,{children:"\u6295\u673a\u91c7\u6837\u793a\u4f8b"}),"\u7ae0\u8282\u3002"]}),"\n",(0,r.jsx)(e.h4,{id:"\u914d\u7f6e\u9879\u8bf4\u660e",children:"\u914d\u7f6e\u9879\u8bf4\u660e"}),"\n",(0,r.jsxs)(e.table,{children:[(0,r.jsx)(e.thead,{children:(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.th,{children:(0,r.jsx)(e.strong,{children:"\u914d\u7f6e\u9879"})}),(0,r.jsx)(e.th,{children:(0,r.jsx)(e.strong,{children:"\u662f\u5426\u5fc5\u586b"})}),(0,r.jsx)(e.th,{children:(0,r.jsx)(e.strong,{children:"\u6570\u636e\u7c7b\u578b"})}),(0,r.jsx)(e.th,{children:(0,r.jsx)(e.strong,{children:"\u63cf\u8ff0"})})]})}),(0,r.jsxs)(e.tbody,{children:[(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"model_name"}),(0,r.jsx)(e.td,{children:"\u662f"}),(0,r.jsx)(e.td,{children:"str"}),(0,r.jsx)(e.td,{children:"\u5f85\u90e8\u7f72\u6a21\u578b\u7684\u540d\u79f0\uff0c\u5efa\u8bae\u4e0eHuggingFace\u7b49\u6e20\u9053\u4e2d\u7684\u540d\u79f0\u4fdd\u6301\u4e00\u81f4\u3002"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"devices"}),(0,r.jsx)(e.td,{children:"\u662f"}),(0,r.jsx)(e.td,{children:"list"}),(0,r.jsx)(e.td,{children:"\u6a21\u578b\u63a8\u7406\u65f6\u5360\u7528NPU\u8bbe\u5907\u7684ID\u5217\u8868\uff0cSTC_LLM\u4f1a\u6839\u636eNPU\u8bbe\u5907\u7684\u6570\u91cf\u5c06\u539f\u59cb\u6743\u91cd\u81ea\u52a8\u5207\u5206\u4e3a\u5339\u914d\u7684\u4efd\u6570\u3002"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"tok_dir"}),(0,r.jsx)(e.td,{children:"\u662f"}),(0,r.jsx)(e.td,{children:"str"}),(0,r.jsx)(e.td,{children:"\u52a0\u8f7d\u6a21\u578b\u7684\u5206\u8bcd\u5668\uff08tokenizer\uff09\u6587\u4ef6\u7684\u8def\u5f84\u3002"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"compiler"}),(0,r.jsx)(e.td,{children:"\u662f"}),(0,r.jsx)(e.td,{children:"str"}),(0,r.jsx)(e.td,{children:"mltc\uff1a\u91c7\u7528MLTC\u7f16\u8bd1\u5668\u7f16\u8bd1\u3002stc_llm_dnn\uff1a\u9ed8\u8ba4\u503c\uff0c\u91c7\u7528\u624b\u5199\u65b9\u5f0f\u7f16\u8bd1\u3002"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"embed_on_host"}),(0,r.jsx)(e.td,{children:"\u5426"}),(0,r.jsx)(e.td,{children:"bool"}),(0,r.jsxs)(e.td,{children:["- True\uff1a\u542f\u7528host\u4fa7word_embedding\u8ba1\u7b97\u3002",(0,r.jsx)("br",{}),"- False\uff1a\u9ed8\u8ba4\u503c\u3002\u7981\u7528host\u4fa7word_embedding\u8ba1\u7b97\u3002"]})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"output_on_host"}),(0,r.jsx)(e.td,{children:"\u5426"}),(0,r.jsx)(e.td,{children:"bool"}),(0,r.jsxs)(e.td,{children:["- True\uff1a\u542f\u7528host\u4fa7logits\u8ba1\u7b97\u3002",(0,r.jsx)("br",{}),"- False\uff1a\u9ed8\u8ba4\u503c\u3002\u7981\u7528host\u4fa7logits\u8ba1\u7b97\u3002"]})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"original_weight_dir"}),(0,r.jsx)(e.td,{children:"\u5426"}),(0,r.jsx)(e.td,{children:"str"}),(0,r.jsxs)(e.td,{children:["\u52a0\u8f7d\u6a21\u578b\u7684\u539f\u59cb\u6743\u91cd\u6587\u4ef6\u7684\u8def\u5f84\u3002\u5982\u679c\u60a8\u6ca1\u6709\u5728\u76ee\u6807\u670d\u52a1\u5668\u4e0a\u8f6c\u6362\u8fc7\u6743\u91cd\uff0c\u5219\u81f3\u5c11\u9700\u8981\u4ece\u539f\u59cb\u6743\u91cd\u8f6c\u6362\u4e00\u6b21\uff0c\u8fd9\u65f6",(0,r.jsx)(e.code,{children:"original_weight_dir"}),"\u4e3a\u5fc5\u586b\u9879\u3002"]})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"weight_dir"}),(0,r.jsx)(e.td,{children:"\u5426"}),(0,r.jsx)(e.td,{children:"str"}),(0,r.jsxs)(e.td,{children:["\u4ece\u539f\u59cb\u6743\u91cd\u8f6c\u6362\u540e\u53ef\u4ee5\u5728NPU\u8bbe\u5907\u4e0a\u4f7f\u7528\u7684\u6743\u91cd\u7684\u8def\u5f84\u3002",(0,r.jsx)("br",{}),"- \u5982\u679c",(0,r.jsx)(e.code,{children:"weight_dir"}),"\u6307\u5411\u7684\u8def\u5f84\u5b58\u5728\u6743\u91cd\u6587\u4ef6\uff0c\u5219\u4f7f\u7528\u8fd9\u4e9b\u6743\u91cd\u3002",(0,r.jsx)("br",{}),"- \u5982\u679c",(0,r.jsx)(e.code,{children:"weight_dir"}),"\u6307\u5411\u7684\u8def\u5f84\u4e0d\u5b58\u5728\u6743\u91cd\u6587\u4ef6\uff0c\u5219STC_LLM\u5c1d\u8bd5\u4ece",(0,r.jsx)(e.code,{children:"original_weight_dir"}),"\u83b7\u53d6\u539f\u59cb\u6743\u91cd\u8fdb\u884c\u8f6c\u6362\uff0c\u5e76\u5c06\u8f6c\u6362\u540e\u7684\u6743\u91cd\u653e\u5230",(0,r.jsx)(e.code,{children:"weight_dir"}),"\u6307\u5411\u7684\u8def\u5f84\u3002"]})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"mltc_weight_dir"}),(0,r.jsxs)(e.td,{children:["\u662f",(0,r.jsx)("br",{}),"\u8bf4\u660e\uff1a\u5f53\u91c7\u7528MLTC\u7f16\u8bd1\u65b9\u5f0f\u65f6\u4e3a\u5fc5\u586b\u3002"]}),(0,r.jsx)(e.td,{children:"str"}),(0,r.jsx)(e.td,{children:"\u91c7\u7528MLTC\u7f16\u8bd1\u65b9\u5f0f\u65f6\u7684\u6743\u91cd\u8def\u5f84\u3002"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"mltc_ht_file"}),(0,r.jsx)(e.td,{children:"\u5426"}),(0,r.jsx)(e.td,{children:"str"}),(0,r.jsx)(e.td,{children:"\u91c7\u7528MLTC\u7f16\u8bd1\u65b9\u5f0f\u65f6\uff0cvmfb\u6587\u4ef6\u5b58\u653e\u7684\u8def\u5f84\u3002"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"engine_dir"}),(0,r.jsx)(e.td,{children:"\u5426"}),(0,r.jsx)(e.td,{children:"str"}),(0,r.jsxs)(e.td,{children:["\u4e34\u65f6\u8def\u5f84\uff0c\u5b58\u653e\u751f\u6210\u7684\u6a21\u578b\u4ee3\u7801\uff08cpp\uff09\u6587\u4ef6\u3002STC_LLM\u4f1a\u57fa\u4e8e\u6a21\u578b\u4ee3\u7801\u6587\u4ef6\u751f\u6210NPU\u8bbe\u5907\u4e0a\u7684\u53ef\u6267\u884c\u6587\u4ef6\uff0c\u60a8\u53ef\u4ee5\u67e5\u770b\u6a21\u578b\u4ee3\u7801\u6587\u4ef6\u4e86\u89e3\u4ee3\u7801\u903b\u8f91\u6216\u8005\u8fdb\u884c\u6a21\u578b\u8c03\u8bd5\u3002\u9ed8\u8ba4\u503c\u4e3a",(0,r.jsx)(e.code,{children:".cache/stc_llm"}),"\u3002"]})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"slot_number_per_segment"}),(0,r.jsx)(e.td,{children:"\u5426"}),(0,r.jsx)(e.td,{children:"int"}),(0,r.jsx)(e.td,{children:"\u6bcf\u4e2asegment\u5360\u7528\u7684slot\u7684\u6570\u91cf\uff0c\u5bf9\u5e94\u4e00\u7ec4token\u6240\u9700\u7684KV Cache\u7a7a\u95f4\u3002\u9ed8\u8ba4\u503c\u4e3a256\u3002"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"max_tasks"}),(0,r.jsx)(e.td,{children:"\u5426"}),(0,r.jsx)(e.td,{children:"int"}),(0,r.jsx)(e.td,{children:"\u652f\u6301\u540c\u65f6\u6267\u884c\u7684\u6700\u5927task\u6570\u91cf\uff0c\u6bcf\u4e2atask\u5206\u914d\u4e00\u4e2astream\u5b8c\u6210\u4e00\u8f6e\u5bf9\u8bdd\u3002\u9ed8\u8ba4\u503c\u4e3a256\u3002"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"custom_parameters"}),(0,r.jsx)(e.td,{children:"\u5426"}),(0,r.jsx)(e.td,{children:"bool"}),(0,r.jsxs)(e.td,{children:["- True\uff1a\u5141\u8bb8task\u81ea\u5b9a\u4e49temperature\u3001top_p\u3001top_k\u3001logprobs\u3001top_logprobs\u3002",(0,r.jsx)("br",{}),"- False\uff1a\u9ed8\u8ba4\u503c\u3002\u7981\u6b62task\u81ea\u5b9a\u4e49temperature\u3001top_p\u3001top_k\u3001logprobs\u3001top_logprobs\u3002"]})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"temperature"}),(0,r.jsx)(e.td,{children:"\u5426"}),(0,r.jsx)(e.td,{children:"float"}),(0,r.jsx)(e.td,{children:"\u8d85\u53c2\u6570\u4e4b\u4e00\uff0c\u63a7\u5236\u751f\u6210\u8f93\u51fa\u7684\u968f\u673a\u6027\uff0c\u503c\u8d8a\u4f4e\u4fdd\u8bc1\u66f4\u591a\u7684\u786e\u5b9a\u6027\uff0c\u503c\u8d8a\u9ad8\u5f15\u5165\u66f4\u591a\u7684\u968f\u673a\u6027\u3002\u9700\u8981\u5c06custom_parameters\u914d\u7f6e\u4e3aTrue\u624d\u53ef\u4ee5\u4fee\u6539\uff0c\u9ed8\u8ba4\u503c\u4e3a0.5\uff0c\u6570\u503c\u8303\u56f4\u4e3a[0.0, 2.0]\u3002"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"top_p"}),(0,r.jsx)(e.td,{children:"\u5426"}),(0,r.jsx)(e.td,{children:"float"}),(0,r.jsx)(e.td,{children:"\u8d85\u53c2\u6570\u4e4b\u4e00\uff0c\u5728\u751f\u6210\u8f93\u51fa\u62bd\u6837\u65f6\u6392\u9664\u7d2f\u79ef\u6982\u7387\u4f4e\u4e8e\u8be5\u503c\u7684token\u3002\u9700\u8981\u5c06custom_parameters\u914d\u7f6e\u4e3aTrue\u624d\u53ef\u4ee5\u4fee\u6539\uff0c\u9ed8\u8ba4\u503c\u4e3a0.2\uff0c\u6570\u503c\u8303\u56f4\u4e3a(0.0, 1.0]\u3002"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"top_k"}),(0,r.jsx)(e.td,{children:"\u5426"}),(0,r.jsx)(e.td,{children:"int"}),(0,r.jsx)(e.td,{children:"\u8d85\u53c2\u6570\u4e4b\u4e00\uff0c\u5728\u751f\u6210\u8f93\u51fa\u62bd\u6837\u65f6\u53ea\u5728\u6982\u7387top k\u4e2atoken\u4e2d\u8fdb\u884c\u3002\u9700\u8981\u5c06custom_parameters\u914d\u7f6e\u4e3aTrue\u624d\u53ef\u4ee5\u4fee\u6539\uff0c\u9ed8\u8ba4\u503c\u4e3a20\uff0c\u6570\u503c\u8303\u56f4\u4e3a[1, \u8bcd\u8868\u957f\u5ea6]\u3002"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"dma_preload"}),(0,r.jsx)(e.td,{children:"\u5426"}),(0,r.jsx)(e.td,{children:"bool"}),(0,r.jsxs)(e.td,{children:["- True\uff1a\u9ed8\u8ba4\u503c\u3002\u542f\u7528DMA\u9884\u53d6\uff0c\u901a\u8fc7\u62f7\u8d1d\u6743\u91cd\u3001\u77e9\u9635\u8ba1\u7b97\u7b49\u5e76\u884c\u64cd\u4f5c\u52a0\u901f\u63a8\u7406\u3002",(0,r.jsx)("br",{}),"- False\uff1a\u7981\u7528DMA\u9884\u53d6\u3002"]})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"render_cpp"}),(0,r.jsx)(e.td,{children:"\u5426"}),(0,r.jsx)(e.td,{children:"bool"}),(0,r.jsxs)(e.td,{children:["- True\uff1a\u9ed8\u8ba4\u503c\u3002\u90e8\u7f72\u6a21\u578b\u65f6\u91cd\u65b0\u751f\u6210\u5e76\u8986\u76d6\u5f53\u524d\u7684\u6a21\u578b\u4ee3\u7801\uff08cpp\uff09\u6587\u4ef6\u3002",(0,r.jsx)("br",{}),"- False\uff1a\u90e8\u7f72\u6a21\u578b\u65f6\u4f7f\u7528\u5f53\u524d\u7684\u6a21\u578b\u4ee3\u7801\uff08cpp\uff09\u6587\u4ef6\uff0c\u4e0d\u91cd\u65b0\u751f\u6210\u3002"]})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"quant_type"}),(0,r.jsx)(e.td,{children:"\u5426"}),(0,r.jsx)(e.td,{children:"str"}),(0,r.jsxs)(e.td,{children:["\u6307\u5b9a\u662f\u5426\u901a\u8fc7\u91cf\u5316\u8282\u7701\u5185\u5b58\u7a7a\u95f4\u3002",(0,r.jsx)("br",{}),"- fp16\uff1a\u9ed8\u8ba4\u503c\uff0c\u4e0d\u542f\u7528\u538b\u7f29\u548c\u91cf\u5316\u3002",(0,r.jsx)("br",{}),"- w8a8\uff1a\u542f\u7528\u91cf\u5316\u3002",(0,r.jsx)("br",{}),"- w8a16\uff1a\u542f\u7528\u538b\u7f29\u3002"]})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"compress_factor"}),(0,r.jsx)(e.td,{children:"\u5426"}),(0,r.jsx)(e.td,{children:"int"}),(0,r.jsxs)(e.td,{children:["\u538b\u7f29\u500d\u6570\uff0c\u4ec5\u5728",(0,r.jsx)(e.code,{children:"quant_type"}),"\u4e3a",(0,r.jsx)(e.code,{children:"w8a16"}),"\u65f6\u751f\u6548\uff0c\u652f\u6301\u7684\u538b\u7f29\u500d\u6570\u5305\u62ec128\u300164\u300132\u300116\u30018\u30011\u3001-1\uff0c\u538b\u7f29\u500d\u6570\u8d8a\u9ad8\uff0c\u80fd\u8282\u7701\u7684\u5185\u5b58\u7a7a\u95f4\u8d8a\u591a\u3002\u538b\u7f29\u500d\u6570\u4e3a-1\u65f6\u5bf9\u5e94per-channel\u65b9\u5f0f\u3002"]})]})]})]}),"\n",(0,r.jsx)(e.h3,{id:"\u5ba2\u6237\u7aef\u53d1\u8d77\u63a8\u7406\u8bf7\u6c42",children:"\u5ba2\u6237\u7aef\u53d1\u8d77\u63a8\u7406\u8bf7\u6c42"}),"\n",(0,r.jsx)(e.h4,{id:"\u53d1\u8d77\u63a8\u7406\u8bf7\u6c42",children:"\u53d1\u8d77\u63a8\u7406\u8bf7\u6c42"}),"\n",(0,r.jsx)(e.p,{children:"\u5728\u5ba2\u6237\u7aef\u8c03\u7528completions\u6216\u8005chat_completions\u63a5\u53e3\u53d1\u8d77\u63a8\u7406\u8bf7\u6c42\u3002"}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsx)(e.p,{children:"\u8865\u5168\u6587\u672c\u793a\u4f8b\uff0c\u5411LLM\u63d0\u4f9b\u8d77\u59cb\u6587\u672c\uff0cLLM\u81ea\u52a8\u5c06\u8d77\u59cb\u6587\u672c\u8865\u5168\u4e3a\u4e00\u6bb5\u8bdd\u3001\u6587\u7ae0\u7b49\u5f62\u5f0f\u3002"}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsx)(e.p,{children:"curl\u65b9\u5f0f\uff1a"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-bash",children:'# \u8c03\u7528completions\u63a5\u53e3\u793a\u4f8b\n$ curl http://172.16.xx.xxx:8000/v1/completions \\\n    -H "Content-Type: application/json" \\\n    -d \'{\n        "model": "Qwen/Qwen2-7B-Instruct",\n        "prompt": "\u4f60\u662f\u4e00\u4e2a\u5199\u4f5c\u5c0f\u52a9\u624b\uff0c\u8bf7\u5e2e\u5fd9\u5199\u4e00\u7bc7\u63cf\u8ff0\u6c5f\u5357\u6625\u5929\u957f\u5ea6\u4e0d\u5c11\u4e8e1024\u4e2atoken\u7684\u5c0f\u4f5c\u6587\uff0c\u8981\u6c42\u5176\u4e2d\u5fc5\u987b\u6d89\u53ca\u5230\u63cf\u8ff0\u6726\u80e7\u7684\u70df\u96e8\uff0c\u873f\u8712\u7684\u77f3\u677f\u5c0f\u8def\u7b49\u666f\u7269\uff0c\u540c\u65f6\u65e2\u8981\u63cf\u5199\u51fa\u9633\u5149\u660e\u5a9a\u3001\u98ce\u548c\u65e5\u4e3d\u7684\u573a\u666f\uff0c\u4e5f\u8981\u63cf\u8ff0\u51fa\u70df\u96e8\u7ef5\u7ef5\u3001\u4e91\u6c14\u6c24\u6c32\u7684\u573a\u666f\u3002\u7136\u540e\u6587\u7ae0\u4e2d\u9700\u8981\u5305\u542b\u6392\u6bd4\u3001\u6bd4\u55bb\u3001\u5bf9\u5076\u3001\u62df\u4eba\u7b49\u4fee\u8f9e\u624b\u6cd5\uff0c\u5fc5\u8981\u65f6\u53ef\u4ee5\u5f15\u7528\u4e00\u4e9b\u7b26\u5408\u6587\u7ae0\u4e3b\u9898\u8bed\u5883\u7684\u53e4\u8bd7\u8bcd\u4e2d\u7684\u53e5\u5b50\u4ee5\u589e\u52a0\u6587\u91c7\u3002",\n        "max_tokens": 256,\n    }\'\n    \n{"model":"Qwen/Qwen2-7B-Instruct","object":"text_completion","created":1736219436,"choices":[{"index":0,"text":"\u6c5f\u5357\u7684\u6625\u5929\uff0c\u5982\u540c\u4e00\u4f4d\u7f9e\u6da9\u7684\u5c11\u5973\uff0c\u8f7b\u542f\u6731\u5507\uff0c\u5410\u9732\u7740\u6e29\u67d4\u7684\u6c14\u606f\u3002\u5979\u4ee5\u4e00\u79cd\u96be\u4ee5\u8a00\u55bb\u7684\u7f8e\uff0c\u7f13\u7f13\u94fa\u5c55\u5f00\u4e00\u5e45\u5e45\u7ec6\u817b\u7684\u753b\u5377\uff0c\u8ba9\u4eba\u5fc3\u9189\u795e\u8ff7\u3002\u5728\u8fd9\u7247\u571f\u5730\u4e0a\uff0c\u6625\u5929\u7684\u957f\u5ea6\u4eff\u4f5b\u88ab\u65f6\u95f4\u7684\u7b14\u89e6\u62c9\u957f\uff0c\u6bcf\u4e00\u523b\u90fd\u5145\u6ee1\u4e86\u8bd7\u610f\u4e0e\u751f\u673a\u3002\\n\\n\u70df\u96e8\u662f\u6c5f\u5357\u6625\u5929\u7684\u9b42\u9b44\uff0c\u5b83\u8f7b\u67d4\u5730\u62c2\u8fc7\u6bcf\u4e00\u5bf8\u571f\u5730\uff0c\u4e3a\u5927\u5730\u62ab\u4e0a\u4e86\u4e00\u5c42\u8584\u8584\u7684\u8f7b\u7eb1\u3002\u90a3\u70df\u96e8\uff0c\u5982\u540c\u7ec6\u4e1d\u822c\u7f20\u7ed5\u5728\u53e4\u8001\u7684\u77f3\u677f\u5c0f\u8def\u4e0a\uff0c\u873f\u8712\u66f2\u6298\uff0c\u4eff\u4f5b\u662f\u5927\u81ea\u7136\u7684\u7b14\u89e6\uff0c\u52fe\u52d2\u51fa\u4e00\u5e45\u5e45\u6c34\u58a8\u753b\u3002\u96e8\u6ef4\u843d\u5728\u9752\u77f3\u677f\u4e0a\uff0c\u53d1\u51fa\u6e05\u8106\u7684\u54cd\u58f0\uff0c\u5982\u540c\u53e4\u7434\u7684\u4f4e\u541f\uff0c\u60a0\u626c\u800c\u6df1\u9083\u3002\u8fd9\u70df\u96e8\uff0c\u662f\u6c5f\u5357\u6625\u5929\u7684\u5e8f\u66f2\uff0c\u5b83\u4ee5\u4e00\u79cd\u6726\u80e7\u800c\u795e\u79d8\u7684\u65b9\u5f0f\uff0c\u5524\u9192\u4e86\u6c89\u7761\u7684\u5927\u5730\uff0c\u8ba9\u4e07\u7269\u5728\u6e7f\u6da6\u4e2d\u82cf\u9192\u3002\\n\\n\u9633\u5149\u660e\u5a9a\u7684\u65e5\u5b50\uff0c\u6c5f\u5357\u7684\u6625\u5929\u5219\u5c55\u73b0\u51fa\u53e6\u4e00\u756a\u666f\u8c61\u3002\u9633\u5149\u5982\u540c\u91d1\u8272\u7684\u4e1d\u7ebf\uff0c\u6e29\u67d4\u5730\u6d12\u5728\u5927\u5730\u4e0a\uff0c\u5c06\u4e07\u7269\u67d3\u4e0a\u4e86\u4e00\u5c42\u91d1\u9ec4\u7684\u5149\u6cfd\u3002\u5fae\u98ce\u8f7b\u62c2\uff0c\u5e26\u7740\u82b1\u9999\u4e0e\u6ce5\u571f\u7684\u82ac\u82b3\uff0c\u8ba9\u4eba\u611f\u5230\u5fc3\u65f7","finish_reason":"stop"}]}\n'})}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsx)(e.p,{children:"Python\u811a\u672c\u65b9\u5f0f\uff1a"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-bash",children:"# \u8c03\u7528completions\u63a5\u53e3\u793a\u4f8b\n$ pip3 install openai\n\n$ cat test_qwen2-7b-instruct-completions.py\nfrom openai import OpenAI\n\nopenai_api_key = \"EMPTY\"\nopenai_api_base = \"http://172.16.xxx.xxx:8000/v1\"\nclient = OpenAI(\n    api_key=openai_api_key,\n    base_url=openai_api_base,\n)\n\ncompletion = client.completions.create(model=\"Qwen/Qwen2-7B-Instruct\", prompt=\"San Francisco is a\", max_tokens=50)\n\n$ python3 test_qwen2-7b-instruct-completions.py\nCompletion result: Completion(id=None, choices=[CompletionChoice(finish_reason='stop', index=0, logprobs=None, text='San Francisco is a city located in the northern part of California, United States. It is known for its iconic landmarks such as the Golden Gate Bridge, Alcatraz Island, and the hilly landscape. San Francisco is also famous for its diverse culture')], created=1736235685, model='Qwen/Qwen2-7B-Instruct', object='text_completion', system_fingerprint=None, usage=None)\n"})}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsx)(e.p,{children:"\u53d1\u8d77\u804a\u5929\u793a\u4f8b\uff0c\u5411LLM\u63d0\u4f9b\u7cfb\u7edf\u89d2\u8272\u4fe1\u606f\u4ee5\u53ca\u804a\u5929\u8f93\u5165\uff0cLLM\u7406\u89e3\u8f93\u5165\u5e76\u6309\u5176\u7cfb\u7edf\u89d2\u8272\u56de\u590d\u7528\u6237\u3002"}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsx)(e.p,{children:"curl\u65b9\u5f0f\uff1a"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-bash",children:'# \u8c03\u7528chat_completions\u63a5\u53e3\u793a\u4f8b\n$ curl http:/localhost:8000/v1/chat/completions \\\n    -H "Content-Type: application/json" \\\n    -d \'{\n        "model": "Qwen/Qwen2-7B-Instruct",\n        "messages": [\n            {"role": "system", "content": "You are a helpful assistant."},\n            {"role": "user", "content": "Tell me a joke."}\n        ]\n    }\'\n    \n{"model":"Qwen/Qwen2-7B-Instruct","object":"chat.completion","choices":[{"index":0,"message":{"role":"assistant","content":"Sure, here\'s a classic joke:\\n\\nWhy did the tomato turn red?\\n\\nBecause it saw the salad dressing!","function_call":null},"finish_reason":"stop","logprobs":{"content":null}}],"created":1736235856}\n'})}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsx)(e.p,{children:"Python\u811a\u672c\u793a\u4f8b\uff1a"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-bash",children:'# \u8c03\u7528completions\u63a5\u53e3\u793a\u4f8b\n$ pip3 install openai\n\n$ cat test_qwen2-7b-instruct-chat-completions.py\nfrom openai import OpenAI\n\nopenai_api_key = "EMPTY"\nopenai_api_base = "http://172.16.xxx.xxx:8000/v1"\nclient = OpenAI(\n    api_key=openai_api_key,\n    base_url=openai_api_base,\n)\n\nchat_response = client.chat.completions.create(\n    model="Qwen/Qwen2-7B-Instruct",\n    messages=[\n        {"role": "system", "content": "You are a helpful assistant."},\n        {"role": "user", "content": "Tell me a joke."},\n    ],\n    max_tokens=256\n)\nprint("Chat response:", chat_response)\n\n$ python3 test_qwen2-7b-instruct-chat-completions.py\nChat response: ChatCompletion(id=None, choices=[Choice(finish_reason=\'stop\', index=0, logprobs=ChoiceLogprobs(content=None, refusal=None), message=ChatCompletionMessage(content="Sure, here\'s a classic joke:\\n\\nWhy did the tomato turn red?\\n\\nBecause it saw the salad dressing!", refusal=None, role=\'assistant\', audio=None, function_call=None, tool_calls=None))], created=1736236505, model=\'Qwen/Qwen2-7B-Instruct\', object=\'chat.completion\', service_tier=None, system_fingerprint=None, usage=None)\n'})}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(e.h4,{id:"completions\u53c2\u6570",children:"completions\u53c2\u6570"}),"\n",(0,r.jsxs)(e.table,{children:[(0,r.jsx)(e.thead,{children:(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.th,{children:(0,r.jsx)(e.strong,{children:"\u53c2\u6570\u540d"})}),(0,r.jsx)(e.th,{children:(0,r.jsx)(e.strong,{children:"\u662f\u5426\u5fc5\u586b"})}),(0,r.jsx)(e.th,{children:(0,r.jsx)(e.strong,{children:"\u6570\u636e\u7c7b\u578b"})}),(0,r.jsx)(e.th,{children:(0,r.jsx)(e.strong,{children:"\u63cf\u8ff0"})})]})}),(0,r.jsxs)(e.tbody,{children:[(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"model"}),(0,r.jsx)(e.td,{children:"\u662f"}),(0,r.jsx)(e.td,{children:"str"}),(0,r.jsx)(e.td,{children:"\u5f85\u8c03\u7528\u6a21\u578b\u7684\u540d\u79f0\uff0c\u4e00\u822c\u4e3a\u542f\u52a8\u63a8\u7406\u670d\u52a1\u65f6\u6240\u8fd0\u884c\u7684\u6a21\u578b\u540d\u79f0\u3002"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"prompt"}),(0,r.jsx)(e.td,{children:"\u662f"}),(0,r.jsx)(e.td,{children:"str"}),(0,r.jsx)(e.td,{children:"\u63cf\u8ff0\u8981\u6c42\u6a21\u578b\u5b8c\u6210\u7684\u4efb\u52a1\uff0c\u4f8b\u5982\u8865\u5168\u6587\u672c\u3001\u56de\u7b54\u95ee\u9898\u3002"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"temperature"}),(0,r.jsx)(e.td,{children:"\u5426"}),(0,r.jsx)(e.td,{children:"float"}),(0,r.jsx)(e.td,{children:"\u8d85\u53c2\u6570\u4e4b\u4e00\uff0c\u63a7\u5236\u751f\u6210\u8f93\u51fa\u7684\u968f\u673a\u6027\uff0c\u503c\u8d8a\u4f4e\u4fdd\u8bc1\u66f4\u591a\u7684\u786e\u5b9a\u6027\uff0c\u503c\u8d8a\u9ad8\u5f15\u5165\u66f4\u591a\u7684\u968f\u673a\u6027\u3002\u9700\u8981\u5728\u90e8\u7f72\u6a21\u578b\u65f6\u5c06custom_parameters\u914d\u7f6e\u4e3aTrue\u624d\u53ef\u4ee5\u4fee\u6539\uff0c\u6570\u503c\u8303\u56f4\u4e3a[0.0, 2.0]\u3002"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"top_p"}),(0,r.jsx)(e.td,{children:"\u5426"}),(0,r.jsx)(e.td,{children:"float"}),(0,r.jsx)(e.td,{children:"\u8d85\u53c2\u6570\u4e4b\u4e00\uff0c\u5728\u751f\u6210\u8f93\u51fa\u62bd\u6837\u65f6\u6392\u9664\u7d2f\u79ef\u6982\u7387\u4f4e\u4e8e\u8be5\u503c\u7684token\u3002\u9700\u8981\u5728\u90e8\u7f72\u6a21\u578b\u65f6\u5c06custom_parameters\u914d\u7f6e\u4e3aTrue\u624d\u53ef\u4ee5\u4fee\u6539\uff0c\u6570\u503c\u8303\u56f4\u4e3a(0.0, 1.0]\u3002"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"top_k"}),(0,r.jsx)(e.td,{children:"\u5426"}),(0,r.jsx)(e.td,{children:"int"}),(0,r.jsx)(e.td,{children:"\u8d85\u53c2\u6570\u4e4b\u4e00\uff0c\u5728\u751f\u6210\u8f93\u51fa\u62bd\u6837\u65f6\u53ea\u5728\u6982\u7387top k\u4e2atoken\u4e2d\u8fdb\u884c\u3002\u9700\u8981\u5728\u90e8\u7f72\u6a21\u578b\u65f6\u5c06custom_parameters\u914d\u7f6e\u4e3aTrue\u624d\u53ef\u4ee5\u4fee\u6539\uff0c\u6570\u503c\u8303\u56f4\u4e3a[1, \u8bcd\u8868\u957f\u5ea6]\u3002"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"max_tokens"}),(0,r.jsx)(e.td,{children:"\u5426"}),(0,r.jsx)(e.td,{children:"int"}),(0,r.jsx)(e.td,{children:"\u6700\u957f\u8fd4\u56de\u7684token\u6570\u91cf\u3002\u6570\u503c\u8303\u56f4\u4e3a[1, \u6a21\u578b\u652f\u6301\u4e0a\u4e0b\u6587\u957f\u5ea6]\u3002"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"logprobs"}),(0,r.jsx)(e.td,{children:"\u5426"}),(0,r.jsx)(e.td,{children:"bool"}),(0,r.jsxs)(e.td,{children:["\u9700\u8981\u5728\u90e8\u7f72\u6a21\u578b\u65f6\u5c06custom_parameters\u914d\u7f6e\u4e3aTrue\u624d\u53ef\u4ee5\u4fee\u6539\u3002",(0,r.jsx)("br",{}),"- true\uff1a\u542f\u7528\u8fd4\u56de\u751f\u6210\u8f93\u51fatoken\u7684\u5bf9\u6570\u6982\u7387\u3002",(0,r.jsx)("br",{}),"- false\uff1a\u9ed8\u8ba4\u503c\uff0c\u7981\u7528\u8fd4\u56de\u751f\u6210\u8f93\u51fatoken\u7684\u5bf9\u6570\u6982\u7387\u3002"]})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"top_logprobs"}),(0,r.jsx)(e.td,{children:"\u5426"}),(0,r.jsx)(e.td,{children:"int"}),(0,r.jsx)(e.td,{children:"\u6307\u5b9a\u5728\u6bcf\u4e2a\u751f\u6210\u8f93\u51fatoken\u65f6\u4e00\u5e76\u8fd4\u56de\u6700\u6709\u53ef\u80fd\u7684token\u6570\u91cf\uff0c\u6bcf\u4e2atoken\u90fd\u5e26\u6709\u5bf9\u6570\u6982\u7387\u3002\u9700\u8981\u5c06logprobs\u5f00\u5173\u8bbe\u7f6e\u4e3atrue\u65b9\u53ef\u751f\u6548\uff0c\u6570\u503c\u8303\u56f4\u4e3a[0, 5]\u3002"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"stream"}),(0,r.jsx)(e.td,{children:"\u5426"}),(0,r.jsx)(e.td,{children:"bool"}),(0,r.jsxs)(e.td,{children:["- true\uff1a\u542f\u7528\u6d41\u5f0f\u4f20\u8f93\uff0c\u5f53\u6a21\u578b\u751f\u6210\u4e00\u5b9a\u6570\u91cf\u7684token\u540e\uff0c\u7acb\u5373\u5c06token\u4f20\u8f93\u7ed9\u5ba2\u6237\u7aef\uff0c\u800c\u4e0d\u662f\u7b49\u6240\u6709token\u751f\u6210\u5b8c\u6bd5\u540e\uff0c\u4ece\u800c\u51cf\u5c11\u7528\u6237\u7684\u7b49\u5f85\u65f6\u95f4\u3002",(0,r.jsx)("br",{}),"- false\uff1a\u9ed8\u8ba4\u503c\uff0c\u7981\u7528\u6d41\u5f0f\u4f20\u8f93\uff0c\u7b49\u6240\u6709token\u751f\u6210\u5b8c\u6bd5\u540e\uff0c\u518d\u5c06\u6240\u6709token\u4f20\u8f93\u7ed9\u5ba2\u6237\u7aef\u3002"]})]})]})]}),"\n",(0,r.jsx)(e.h4,{id:"chat_completions\u53c2\u6570",children:"chat_completions\u53c2\u6570"}),"\n",(0,r.jsxs)(e.table,{children:[(0,r.jsx)(e.thead,{children:(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.th,{children:(0,r.jsx)(e.strong,{children:"\u53c2\u6570\u540d"})}),(0,r.jsx)(e.th,{children:(0,r.jsx)(e.strong,{children:"\u662f\u5426\u5fc5\u586b"})}),(0,r.jsx)(e.th,{children:(0,r.jsx)(e.strong,{children:"\u6570\u636e\u7c7b\u578b"})}),(0,r.jsx)(e.th,{children:(0,r.jsx)(e.strong,{children:"\u63cf\u8ff0"})})]})}),(0,r.jsxs)(e.tbody,{children:[(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"model"}),(0,r.jsx)(e.td,{children:"\u662f"}),(0,r.jsx)(e.td,{children:"str"}),(0,r.jsx)(e.td,{children:"\u5f85\u8c03\u7528\u6a21\u578b\u7684\u540d\u79f0\uff0c\u4e00\u822c\u4e3a\u542f\u52a8\u63a8\u7406\u670d\u52a1\u65f6\u6240\u8fd0\u884c\u7684\u6a21\u578b\u540d\u79f0\u3002"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"messages"}),(0,r.jsx)(e.td,{children:"\u662f"}),(0,r.jsx)(e.td,{children:"dict"}),(0,r.jsxs)(e.td,{children:["\u4f20\u7ed9\u6a21\u578b\u7684\u6d88\u606f\u5bf9\u8c61\uff0c\u60a8\u53ef\u4ee5\u901a\u8fc7\u5b57\u6bb5\u7ec4\u5408\u63a7\u5236\u6a21\u578b\u884c\u4e3a\uff0c\u83b7\u5f97\u9884\u671f\u7684\u8f93\u51fa\u3002",(0,r.jsx)("br",{}),"- role\u5b57\u6bb5\uff1a\u7528\u4e8e\u8bbe\u7f6e\u89d2\u8272\uff0c\u4f8b\u5982system\uff08\u7cfb\u7edf\u89d2\u8272\uff09\u3001user\uff08\u7528\u6237\u89d2\u8272\uff09\u3002",(0,r.jsx)("br",{}),"- content\u5b57\u6bb5\uff1a\u7528\u4e8e\u63cf\u8ff0\u8981\u6c42\uff0c\u4f8b\u5982\u901a\u8fc7system\u63cf\u8ff0\u52a9\u624b\u626e\u6f14\u7684\u7cfb\u7edf\u89d2\u8272\uff0c\u901a\u8fc7user\u63cf\u8ff0\u7528\u6237\u8981\u6c42\u52a9\u624b\u5b8c\u6210\u521b\u4f5c\u6587\u7ae0\u3001\u56de\u7b54\u95ee\u9898\u7b49\u4efb\u52a1\u3002"]})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"temperature"}),(0,r.jsx)(e.td,{children:"\u5426"}),(0,r.jsx)(e.td,{children:"float"}),(0,r.jsx)(e.td,{children:"\u8d85\u53c2\u6570\u4e4b\u4e00\uff0c\u63a7\u5236\u751f\u6210\u8f93\u51fa\u7684\u968f\u673a\u6027\uff0c\u503c\u8d8a\u4f4e\u4fdd\u8bc1\u66f4\u591a\u7684\u786e\u5b9a\u6027\uff0c\u503c\u8d8a\u9ad8\u5f15\u5165\u66f4\u591a\u7684\u968f\u673a\u6027\u3002\u9700\u8981\u5728\u90e8\u7f72\u6a21\u578b\u65f6\u5c06custom_parameters\u914d\u7f6e\u4e3aTrue\u624d\u53ef\u4ee5\u4fee\u6539\uff0c\u6570\u503c\u8303\u56f4\u4e3a[0.0, 2.0]\u3002"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"top_p"}),(0,r.jsx)(e.td,{children:"\u5426"}),(0,r.jsx)(e.td,{children:"float"}),(0,r.jsx)(e.td,{children:"\u8d85\u53c2\u6570\u4e4b\u4e00\uff0c\u5728\u751f\u6210\u8f93\u51fa\u62bd\u6837\u65f6\u6392\u9664\u7d2f\u79ef\u6982\u7387\u4f4e\u4e8e\u8be5\u503c\u7684token\u3002\u9700\u8981\u5728\u90e8\u7f72\u6a21\u578b\u65f6\u5c06custom_parameters\u914d\u7f6e\u4e3aTrue\u624d\u53ef\u4ee5\u4fee\u6539\uff0c\u6570\u503c\u8303\u56f4\u4e3a(0.0, 1.0]\u3002"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"top_k"}),(0,r.jsx)(e.td,{children:"\u5426"}),(0,r.jsx)(e.td,{children:"int"}),(0,r.jsx)(e.td,{children:"\u8d85\u53c2\u6570\u4e4b\u4e00\uff0c\u5728\u751f\u6210\u8f93\u51fa\u62bd\u6837\u65f6\u53ea\u5728\u6982\u7387top k\u4e2atoken\u4e2d\u8fdb\u884c\u3002\u9700\u8981\u5728\u90e8\u7f72\u6a21\u578b\u65f6\u5c06custom_parameters\u914d\u7f6e\u4e3aTrue\u624d\u53ef\u4ee5\u4fee\u6539\uff0c\u6570\u503c\u8303\u56f4\u4e3a[1, \u8bcd\u8868\u957f\u5ea6]\u3002"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"max_tokens"}),(0,r.jsx)(e.td,{children:"\u5426"}),(0,r.jsx)(e.td,{children:"int"}),(0,r.jsx)(e.td,{children:"\u6700\u957f\u8fd4\u56de\u7684token\u6570\u91cf\u3002\u6570\u503c\u8303\u56f4\u4e3a[1, \u6a21\u578b\u652f\u6301\u4e0a\u4e0b\u6587\u957f\u5ea6]\u3002"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"logprobs"}),(0,r.jsx)(e.td,{children:"\u5426"}),(0,r.jsx)(e.td,{children:"bool"}),(0,r.jsxs)(e.td,{children:["\u9700\u8981\u5728\u90e8\u7f72\u6a21\u578b\u65f6\u5c06custom_parameters\u914d\u7f6e\u4e3aTrue\u624d\u53ef\u4ee5\u4fee\u6539\u3002",(0,r.jsx)("br",{}),"- true\uff1a\u542f\u7528\u8fd4\u56de\u751f\u6210\u8f93\u51fatoken\u7684\u5bf9\u6570\u6982\u7387\u3002",(0,r.jsx)("br",{}),"- false\uff1a\u9ed8\u8ba4\u503c\uff0c\u7981\u7528\u8fd4\u56de\u751f\u6210\u8f93\u51fatoken\u7684\u5bf9\u6570\u6982\u7387\u3002"]})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"top_logprobs"}),(0,r.jsx)(e.td,{children:"\u5426"}),(0,r.jsx)(e.td,{children:"int"}),(0,r.jsx)(e.td,{children:"\u6307\u5b9a\u5728\u6bcf\u4e2a\u751f\u6210\u8f93\u51fatoken\u65f6\u4e00\u5e76\u8fd4\u56de\u6700\u6709\u53ef\u80fd\u7684token\u6570\u91cf\uff0c\u6bcf\u4e2atoken\u90fd\u5e26\u6709\u5bf9\u6570\u6982\u7387\u3002\u9700\u8981\u5c06logprobs\u5f00\u5173\u8bbe\u7f6e\u4e3atrue\u65b9\u53ef\u751f\u6548\uff0c\u6570\u503c\u8303\u56f4\u4e3a[0, 5]\u3002"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"stream"}),(0,r.jsx)(e.td,{children:"\u5426"}),(0,r.jsx)(e.td,{children:"bool"}),(0,r.jsxs)(e.td,{children:["- true\uff1a\u542f\u7528\u6d41\u5f0f\u4f20\u8f93\uff0c\u5f53\u6a21\u578b\u751f\u6210\u4e00\u5b9a\u6570\u91cf\u7684token\u540e\uff0c\u7acb\u5373\u5c06token\u4f20\u8f93\u7ed9\u5ba2\u6237\u7aef\uff0c\u800c\u4e0d\u662f\u7b49\u6240\u6709token\u751f\u6210\u5b8c\u6bd5\u540e\uff0c\u4ece\u800c\u51cf\u5c11\u7528\u6237\u7684\u7b49\u5f85\u65f6\u95f4\u3002",(0,r.jsx)("br",{}),"- false\uff1a\u9ed8\u8ba4\u503c\uff0c\u7981\u7528\u6d41\u5f0f\u4f20\u8f93\uff0c\u7b49\u6240\u6709token\u751f\u6210\u5b8c\u6bd5\u540e\uff0c\u518d\u5c06\u6240\u6709token\u4f20\u8f93\u7ed9\u5ba2\u6237\u7aef\u3002"]})]})]})]}),"\n",(0,r.jsx)(e.h2,{id:"\u76d1\u63a7\u63a8\u7406\u6307\u6807",children:"\u76d1\u63a7\u63a8\u7406\u6307\u6807"}),"\n",(0,r.jsx)(e.h3,{id:"\u524d\u63d0\u6761\u4ef6-1",children:"\u524d\u63d0\u6761\u4ef6"}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"\u5df2\u5728\u670d\u52a1\u7aef\u542f\u52a8\u63a8\u7406\u670d\u52a1\u3002"}),"\n"]}),"\n",(0,r.jsx)(e.h3,{id:"\u6307\u6807\u7c7b\u578b",children:"\u6307\u6807\u7c7b\u578b"}),"\n",(0,r.jsx)(e.p,{children:"STC_LLM\u57fa\u4e8ePrometheus\u3001Grafana\u751f\u6001\u5b9e\u73b0\u4e86\u76d1\u63a7\u529f\u80fd\uff0c\u9075\u5faaPrometheus expression\u8bed\u6cd5\u6dfb\u52a0\u9700\u8981\u76d1\u63a7\u7684\u63a8\u7406\u6307\u6807\u5373\u53ef\u3002\u652f\u6301\u7684\u63a8\u7406\u6307\u6807\u5305\u62ec\uff1a"}),"\n",(0,r.jsxs)(e.table,{children:[(0,r.jsx)(e.thead,{children:(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.th,{children:(0,r.jsx)(e.strong,{children:"\u63a8\u7406\u6307\u6807"})}),(0,r.jsx)(e.th,{children:(0,r.jsx)(e.strong,{children:"\u63a8\u7406\u6307\u6807\u542b\u4e49"})}),(0,r.jsx)(e.th,{children:(0,r.jsx)(e.strong,{children:"Prometheus expression\u793a\u4f8b"})})]})}),(0,r.jsxs)(e.tbody,{children:[(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"prompt\u5904\u7406\u541e\u5410"}),(0,r.jsx)(e.td,{children:"\u6bcf\u79d2\u5904\u7406\u8f93\u5165prompt token\u7684\u541e\u5410\u91cf"}),(0,r.jsx)(e.td,{children:(0,r.jsx)(e.code,{children:'stc_llm:avg_prompt_throughput_toks_per_s{model_name="THUDM/chatglm3-6b"}'})})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"generation\u5904\u7406\u541e\u5410"}),(0,r.jsx)(e.td,{children:"\u6bcf\u79d2\u8f93\u51fatoken\u7684\u541e\u5410\u91cf"}),(0,r.jsx)(e.td,{children:(0,r.jsx)(e.code,{children:'stc_llm:avg_generation_throughput_toks_per_s{model_name="THUDM/chatglm3-6b"}'})})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"\u63a8\u7406\u6b21\u6570"}),(0,r.jsx)(e.td,{children:"\u542f\u52a8\u63a8\u7406\u670d\u52a1\u540e\u5b8c\u6210\u63a8\u7406\u7684\u6b21\u6570"}),(0,r.jsx)(e.td,{children:(0,r.jsx)(e.code,{children:'stc_llm:time_to_inference_count{model_name="THUDM/chatglm3-6b"}'})})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"\u9996token\u65f6\u5ef6"}),(0,r.jsx)(e.td,{children:"\u8f93\u51fa\u9996\u5b57token\u82b1\u8d39\u7684\u65f6\u95f4"}),(0,r.jsx)(e.td,{children:(0,r.jsx)(e.code,{children:'stc_llm:first_token_time{model_name="THUDM/chatglm3-6b"}'})})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"\u4efb\u52a1\u63a8\u7406\u603b\u65f6\u5ef6"}),(0,r.jsx)(e.td,{children:"\u5b8c\u6210\u5355\u8f6e\u8f93\u51fa\u82b1\u8d39\u7684\u65f6\u95f4"}),(0,r.jsx)(e.td,{children:(0,r.jsx)(e.code,{children:'stc_llm:task_duration{model_name="THUDM/chatglm3-6b"}'})})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"\u4efb\u52a1decoder\u65f6\u5ef6"}),(0,r.jsx)(e.td,{children:"\u4ece\u8f93\u51fa\u9996\u5b57token\u5f00\u59cb\uff0c\u5230\u5b8c\u6210\u5355\u8f6e\u8f93\u51fa\u6240\u82b1\u8d39\u7684\u65f6\u95f4"}),(0,r.jsx)(e.td,{children:(0,r.jsx)(e.code,{children:'stc_llm:task_decoder_latency{model_name="THUDM/chatglm3-6b"}'})})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"avg generation latency"}),(0,r.jsx)(e.td,{children:"\u8f93\u51fa\u5355\u4f4dtoken\u6240\u82b1\u8d39\u7684\u65f6\u95f4"}),(0,r.jsx)(e.td,{children:(0,r.jsx)(e.code,{children:'stc_llm:avg_generation_latency{model_name="THUDM/chatglm3-6b"}'})})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"running tasks count"}),(0,r.jsx)(e.td,{children:"\u8fdb\u884c\u4e2d\u7684\u5bf9\u8bdd\u4efb\u52a1\u6570\u91cf"}),(0,r.jsx)(e.td,{children:(0,r.jsx)(e.code,{children:'stc_llm:num_requests_running{model_name="THUDM/chatglm3-6b"}'})})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"swapped tasks count"}),(0,r.jsx)(e.td,{children:"\u56e0\u6545\u505c\u6b62\u7684\u5bf9\u8bdd\u4efb\u52a1\u6570\u91cf"}),(0,r.jsx)(e.td,{children:(0,r.jsx)(e.code,{children:'stc_llm:num_requests_swapped{model_name="THUDM/chatglm3-6b"}'})})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"waiting tasks count"}),(0,r.jsx)(e.td,{children:"\u7b49\u5f85\u4e2d\u7684\u5bf9\u8bdd\u4efb\u52a1\u6570\u91cf"}),(0,r.jsx)(e.td,{children:(0,r.jsx)(e.code,{children:'stc_llm:num_requests_waiting{model_name="THUDM/chatglm3-6b"}'})})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"prompt tokens total count"}),(0,r.jsx)(e.td,{children:"\u8f93\u5165prompt token\u7684\u603b\u6570\u91cf"}),(0,r.jsx)(e.td,{children:(0,r.jsx)(e.code,{children:'stc_llm:prompt_tokens_total{model_name="THUDM/chatglm3-6b"}'})})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"generation tokens total count"}),(0,r.jsx)(e.td,{children:"\u8f93\u51fatoken\u7684\u603b\u6570\u91cf"}),(0,r.jsx)(e.td,{children:(0,r.jsx)(e.code,{children:'stc_llm:generation_tokens_total{model_name="THUDM/chatglm3-6b"}'})})]})]})]}),"\n",(0,r.jsx)(e.h3,{id:"\u670d\u52a1\u7aef\u64cd\u4f5c",children:"\u670d\u52a1\u7aef\u64cd\u4f5c"}),"\n",(0,r.jsx)(e.p,{children:"\u60a8\u9700\u8981\u5728\u670d\u52a1\u7aef\u5b89\u88c5Prometheus\u3001Grafana\u5e76\u786e\u4fdd\u76f8\u5173\u670d\u52a1\u6b63\u5e38\u8fd0\u884c\u3002"}),"\n",(0,r.jsxs)(e.ol,{children:["\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsxs)(e.p,{children:["\u5b89\u88c5Prometheus\u3002\u8bf7\u6839\u636e\u670d\u52a1\u5668\u60c5\u51b5\u9009\u62e9\u5408\u9002\u7684\u5b89\u88c5\u65b9\u5f0f\uff0c\u4f8b\u5982APT\u6e90\u3001\u79bb\u7ebf\u5b89\u88c5\u5305\u7b49\uff0c\u76f8\u5173\u8bf4\u660e\u53ef\u4ee5\u53c2\u89c1",(0,r.jsx)(e.a,{href:"https://github.com/prometheus/prometheus",children:"Prometheus\u5b98\u65b9\u5f00\u6e90\u9879\u76ee"}),"\u3002"]}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsxs)(e.p,{children:["\u4fee\u6539Prometheus\u914d\u7f6e\uff0c\u9ed8\u8ba4\u914d\u7f6e\u6587\u4ef6\u4e3a",(0,r.jsx)(e.code,{children:"/etc/prometheus/prometheus.yml"}),"\u3002"]}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsx)(e.p,{children:"\u63d0\u4f9bPrometheus\u670d\u52a1\u7684\u5730\u5740\uff0c\u9ed8\u8ba4\u7aef\u53e3\u53f7\u4e3a9090\u3002"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-yaml",children:'- job_name: "prometheus"\n  static_configs:\n  - targets: ["localhost:9090"]\n'})}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsxs)(e.p,{children:["\u76d1\u63a7\u63a8\u7406\u670d\u52a1\u7684\u5730\u5740\uff0c\u5728\u5bf9\u5e94job\uff08\u5373\u901a\u8fc7stc_llm.entrypoints.openai.api_server\u542f\u52a8\u7684\u63a8\u7406\u670d\u52a1\uff09\u7684",(0,r.jsx)(e.code,{children:"scrape_configs"}),"\u5b57\u6bb5\u4e0b\u6dfb\u52a0IP\u5730\u5740\u548c\u7aef\u53e3\u53f7\u5373\u53ef\u3002"]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-yaml",children:'- job_name: "openai_api"\n  scrape_interval: 5s\n  static_configs:\n  - targets: ["localhost:18000"]\n'})}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsx)(e.p,{children:"\u542f\u52a8Prometheus\u670d\u52a1\u5e76\u786e\u8ba4\u670d\u52a1\u72b6\u6001\u3002"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-bash",children:"$ sudo systemctl start prometheus\n$ sudo systemctl status prometheus\nprometheus.service - Prometheus\n     Loaded: loaded (/etc/systemd/system/prometheus.service; enabled; vendor preset: enabled)\n     Active: active (running) since Mon 2024-08-19 16:24:11 CST; 1h 6min ago\n   Main PID: 3112690 (prometheus)\n      Tasks: 53 (limit: 629145)\n     Memory: 48.4M\n     CGroup: /system.slice/prometheus.service\n             \u2514\u25003112690 /usr/local/bin/prometheus --config.file /etc/prometheus/prometheus.yml --storage.tsdb.path /var/lib/prometheus/ --web.console.templates=/etc/prometheus/consoles --web.console.libra>\n"})}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsxs)(e.p,{children:["\u5b89\u88c5Grafana\u3002\u8bf7\u6839\u636e\u670d\u52a1\u5668\u60c5\u51b5\u9009\u62e9\u5408\u9002\u7684\u5b89\u88c5\u65b9\u5f0f\uff0c\u4f8b\u5982APT\u6e90\u3001\u79bb\u7ebf\u5b89\u88c5\u5305\u7b49\uff0c\u76f8\u5173\u8bf4\u660e\u53ef\u4ee5\u53c2\u89c1",(0,r.jsx)(e.a,{href:"https://github.com/grafana/grafana",children:"Grafana\u5b98\u65b9\u5f00\u6e90\u9879\u76ee"}),"\u3002"]}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsxs)(e.p,{children:["\u4fee\u6539Grafana\u914d\u7f6e\uff0c\u9ed8\u8ba4\u914d\u7f6e\u6587\u4ef6\u4e3a",(0,r.jsx)(e.code,{children:"/etc/grafana/grafana.ini"}),"\u3002"]}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsx)(e.p,{children:"\u63d0\u4f9bGrafana\u670d\u52a1\u7684\u5730\u5740\uff0c\u9ed8\u8ba4\u7aef\u53e3\u53f7\u4e3a3000\u3002"}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsx)(e.p,{children:"\u767b\u5f55Grafana Web\u7aef\u7684\u7528\u6237\u540d\u548c\u5bc6\u7801\u3002"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-yaml",children:"http_port = 3000\nadmin_user = admin\nadmin_password = 123.com\n"})}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsx)(e.p,{children:"\u542f\u52a8Grafana\u670d\u52a1\u5e76\u786e\u8ba4\u670d\u52a1\u72b6\u6001\u3002"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-bash",children:"$ sudo systemctl start grafana-server\n$ sudo systemctl status grafana-server\ngrafana-server.service - Grafana instance\n     Loaded: loaded (/lib/systemd/system/grafana-server.service; disabled; vendor preset: enabled)\n     Active: active (running) since Mon 2024-08-19 10:01:25 CST; 7h ago\n       Docs: http://docs.grafana.org\n   Main PID: 2970010 (grafana)\n      Tasks: 38 (limit: 629145)\n     Memory: 53.8M\n     CGroup: /system.slice/grafana-server.service\n             \u2514\u25002970010 /usr/share/grafana/bin/grafana server --config=/etc/grafana/grafana.ini --pidfile=/run/grafana/grafana-server.pid --packaging=deb cfg:default.paths.logs=/var/log/grafana cfg:defaul>\n"})}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(e.h3,{id:"web\u7aef\u64cd\u4f5cprometheus",children:"Web\u7aef\u64cd\u4f5c\uff08Prometheus\uff09"}),"\n",(0,r.jsx)(e.p,{children:"Prometheus\u63d0\u4f9b\u4e86\u6307\u6807\u6536\u96c6\u548c\u544a\u8b66\u7b49\u76d1\u63a7\u529f\u80fd\uff0c\u60a8\u53ef\u4ee5\u767b\u5f55Prometheus\u7684Web\u9875\u9762\u7ba1\u7406\u9700\u8981\u76d1\u63a7\u7684\u63a8\u7406\u6307\u6807\u3002"}),"\n",(0,r.jsxs)(e.ol,{children:["\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsxs)(e.p,{children:["\u8bbf\u95eePrometheus Web\u9875\u9762\u3002\u5982\u679cPrometheus\u670d\u52a1\u4f7f\u7528\u4e86\u9ed8\u8ba4\u7aef\u53e3\uff0c\u5219Web\u9875\u9762\u5730\u5740\u4e3a",(0,r.jsx)(e.code,{children:"http://{server_ip}:9090"}),"\u3002"]}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsxs)(e.p,{children:["\u5355\u51fb",(0,r.jsx)(e.strong,{children:"Add Panel"}),"\u6dfb\u52a0\u6307\u6807\u9762\u677f\u3002"]}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsxs)(e.p,{children:["\u5728\u8f93\u5165\u6846\u4e2d\u586b\u5199Prometheus expression\uff0c\u4ee5\u76d1\u63a7THUDM/chatglm3-6b\u6a21\u578b\u7684generation\u541e\u5410\u91cf\u4e3a\u4f8b\uff0c\u586b\u5199",(0,r.jsx)(e.code,{children:'stc_llm:avg_generation_throughput_toks_per_s{model_name="THUDM/chatglm3-6b"}'}),"\u3002"]}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsxs)(e.p,{children:["\u5355\u51fb",(0,r.jsx)(e.strong,{children:"Execute"}),"\u5b8c\u6210\u6307\u6807\u6dfb\u52a0\u3002"]}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsxs)(e.p,{children:["\u5355\u51fb",(0,r.jsx)(e.strong,{children:"Graph"}),"\uff0c\u8c03\u6574\u65f6\u95f4\u8303\u56f4\u81f3\u6267\u884c\u4e86\u63a8\u7406\u4efb\u52a1\u7684\u65f6\u95f4\u6bb5\uff0c\u5373\u53ef\u67e5\u770b\u5230\u5bf9\u5e94\u7684\u63a8\u7406\u6307\u6807\u3002"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(e.p,{children:(0,r.jsx)(e.img,{src:s(5238).A+"",width:"1280",height:"598"})}),"\n",(0,r.jsx)(e.h3,{id:"web\u7aef\u64cd\u4f5cgrafana",children:"Web\u7aef\u64cd\u4f5c\uff08Grafana\uff09"}),"\n",(0,r.jsx)(e.p,{children:"Grafana\u63d0\u4f9b\u4e86\u4e30\u5bcc\u548c\u7f8e\u89c2\u7684\u53ef\u89c6\u5316\u529f\u80fd\uff0c\u4f7f\u7528\u65f6\u5c06Prometheus\u6dfb\u52a0\u4e3a\u6570\u636e\u6e90\u5e76\u521b\u5efaDashboard\u6c47\u603bPanel\uff0c\u5373\u53ef\u4e00\u7ad9\u5f0f\u591a\u7ef4\u5ea6\u5c55\u793a\u63a8\u7406\u6307\u6807\u3002"}),"\n",(0,r.jsx)(e.h4,{id:"\u767b\u5f55grafana",children:"\u767b\u5f55Grafana"}),"\n",(0,r.jsxs)(e.ol,{children:["\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsxs)(e.p,{children:["\u8bbf\u95eeGrafana Web\u9875\u9762\u3002\u5982\u679cGrafana\u670d\u52a1\u4f7f\u7528\u4e86\u9ed8\u8ba4\u7aef\u53e3\uff0c\u5219Web\u9875\u9762\u5730\u5740\u4e3a",(0,r.jsx)(e.code,{children:"http://{server_ip}:3000"}),"\u3002"]}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsx)(e.p,{children:"\u8f93\u5165\u914d\u7f6e\u7684\u7528\u6237\u540d\u548c\u5bc6\u7801\u3002"}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(e.h4,{id:"\u6dfb\u52a0prometheus\u6570\u636e\u6e90",children:"\u6dfb\u52a0Prometheus\u6570\u636e\u6e90"}),"\n",(0,r.jsxs)(e.ol,{children:["\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsxs)(e.p,{children:["\u5728\u5de6\u4fa7\u5bfc\u822a\u680f\uff0c\u5355\u51fb",(0,r.jsx)(e.strong,{children:"Connections"})," > ",(0,r.jsx)(e.strong,{children:"Data sources"}),"\u3002"]}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsxs)(e.p,{children:["\u5355\u51fb",(0,r.jsx)(e.strong,{children:"Add datasource"}),"\u3002"]}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsxs)(e.p,{children:["\u9009\u62e9",(0,r.jsx)(e.strong,{children:"Prometheus"}),"\u3002"]}),"\n",(0,r.jsx)(e.p,{children:(0,r.jsx)(e.img,{src:s(6273).A+"",width:"1280",height:"513"})}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsxs)(e.p,{children:["\u5728Settings\u9875\u9762\uff0c\u5b8c\u6210Name\u3001Prometheus server URL\u7b49\u914d\u7f6e\uff0c\u7136\u540e\u5355\u51fb",(0,r.jsx)(e.strong,{children:"Save & Test\u3002"}),"\u63d0\u793a",(0,r.jsx)(e.code,{children:"Successfully queried the Prometheus API."}),"\uff0c\u5373\u4ee3\u8868\u6570\u636e\u6e90\u6dfb\u52a0\u6210\u529f\u3002"]}),"\n",(0,r.jsx)(e.p,{children:(0,r.jsx)(e.img,{src:s(26).A+"",width:"1280",height:"543"})}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(e.h4,{id:"\u521b\u5efastc_llm-dashboard",children:"\u521b\u5efaSTC_LLM Dashboard"}),"\n",(0,r.jsxs)(e.ol,{children:["\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsxs)(e.p,{children:["\u5728\u5de6\u4fa7\u5bfc\u822a\u680f\uff0c\u5355\u51fb",(0,r.jsx)(e.strong,{children:"Dashboards"}),"\u3002"]}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsxs)(e.p,{children:["\u5355\u51fb",(0,r.jsx)(e.strong,{children:"New"})," > ",(0,r.jsx)(e.strong,{children:"New dashboard"}),"\u3002"]}),"\n",(0,r.jsx)(e.p,{children:(0,r.jsx)(e.img,{src:s(9859).A+"",width:"1280",height:"280"})}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsxs)(e.p,{children:["\u5355\u51fb",(0,r.jsx)(e.strong,{children:"Add visualization"}),"\u3002"]}),"\n",(0,r.jsx)(e.p,{children:(0,r.jsx)(e.img,{src:s(460).A+"",width:"901",height:"467"})}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsx)(e.p,{children:"\u9009\u62e9\u5df2\u6dfb\u52a0\u7684Prometheus\u6570\u636e\u6e90\u3002"}),"\n",(0,r.jsx)(e.p,{children:(0,r.jsx)(e.img,{src:s(2085).A+"",width:"1180",height:"698"})}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsxs)(e.p,{children:["\u6dfb\u52a0Panel\u3002\u5207\u6362\u5230Code\u6a21\u5f0f\uff0c\u5728\u8f93\u5165\u6846\u4e2d\u586b\u5199Prometheus expression\uff0c\u4ee5\u76d1\u63a7THUDM/chatglm3-6b\u6a21\u578b\u7684\u63a8\u7406\u6b21\u6570\u4e3a\u4f8b\uff0c\u586b\u5199",(0,r.jsx)(e.code,{children:'stc_llm:time_to_inference_count{model_name="THUDM/chatglm3-6b"}'}),"\uff0c\u5355\u51fb",(0,r.jsx)(e.strong,{children:"Run queries"}),"\u67e5\u770b\u6548\u679c\uff0c\u7136\u540e\u5355\u51fb",(0,r.jsx)(e.strong,{children:"Save"}),"\u3002"]}),"\n",(0,r.jsx)(e.p,{children:(0,r.jsx)(e.img,{src:s(1710).A+"",width:"1280",height:"598"})}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsxs)(e.p,{children:["\u6309\u63d0\u793a\u586b\u5165\u4fe1\u606f\uff0c\u7136\u540e\u5355\u51fb",(0,r.jsx)(e.strong,{children:"Save"}),"\u3002"]}),"\n",(0,r.jsx)(e.p,{children:(0,r.jsx)(e.img,{src:s(7495).A+"",width:"952",height:"402"})}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsx)(e.p,{children:"\u5728Dashboards\u9875\u9762\u5373\u53ef\u770b\u5230\u65b0\u6dfb\u52a0\u7684STC_LLM Dashboard\u3002"}),"\n",(0,r.jsx)(e.p,{children:(0,r.jsx)(e.img,{src:s(3264).A+"",width:"1280",height:"598"})}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsx)(e.p,{children:"\u8fdb\u5165STC_LLM Dashboard\uff0c\u5373\u53ef\u67e5\u770b\u5df2\u6dfb\u52a0\u7684Panel\u3002"}),"\n",(0,r.jsx)(e.p,{children:(0,r.jsx)(e.img,{src:s(7465).A+"",width:"1280",height:"598"})}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(e.h4,{id:"\u7f16\u8f91dashboard\u4e2d\u7684panel",children:"\u7f16\u8f91Dashboard\u4e2d\u7684Panel"}),"\n",(0,r.jsxs)(e.ol,{children:["\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsxs)(e.p,{children:["\u5728\u5de6\u4fa7\u5bfc\u822a\u680f\uff0c\u5355\u51fb",(0,r.jsx)(e.strong,{children:"Dashboards"}),"\u3002"]}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsx)(e.p,{children:"\u5355\u51fbSTC_LLM Dashboard\u3002"}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsxs)(e.p,{children:["\u5728\u5f85\u4fee\u6539Panel\u53f3\u4e0a\u89d2\uff0c\u5355\u51fbMenu\u56fe\u6807 > ",(0,r.jsx)(e.strong,{children:"Edit"}),"\u3002"]}),"\n",(0,r.jsx)(e.p,{children:(0,r.jsx)(e.img,{src:s(7989).A+"",width:"802",height:"306"})}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsxs)(e.p,{children:["\u6309\u9700\u4fee\u6539Panel\u4fe1\u606f\uff0c\u4f8b\u5982\u5c06Title\u4fee\u6539\u4e3a\u63a8\u7406\u6b21\u6570\uff0c\u7136\u540e\u5355\u51fb",(0,r.jsx)(e.strong,{children:"Save"}),"\u3002"]}),"\n",(0,r.jsx)(e.p,{children:(0,r.jsx)(e.img,{src:s(476).A+"",width:"1280",height:"598"})}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsxs)(e.p,{children:["\u6309\u9700\u586b\u5199\u4fe1\u606f\uff0c\u7136\u540e\u5355\u51fb",(0,r.jsx)(e.strong,{children:"Save"}),"\u3002"]}),"\n",(0,r.jsx)(e.p,{children:(0,r.jsx)(e.img,{src:s(9207).A+"",width:"952",height:"304"})}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(e.h4,{id:"\u4e3adashboard\u6dfb\u52a0\u65b0panel",children:"\u4e3aDashboard\u6dfb\u52a0\u65b0Panel"}),"\n",(0,r.jsxs)(e.ol,{children:["\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsxs)(e.p,{children:["\u5728\u5de6\u4fa7\u5bfc\u822a\u680f\uff0c\u5355\u51fb",(0,r.jsx)(e.strong,{children:"Dashboards"}),"\u3002"]}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsx)(e.p,{children:"\u5355\u51fbSTC_LLM Dashboard\u3002"}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsxs)(e.p,{children:["\u5728Dashboard\u4e2d\u5355\u51fb",(0,r.jsx)(e.strong,{children:"Add"})," > ",(0,r.jsx)(e.strong,{children:"Visualization"}),"\u3002"]}),"\n",(0,r.jsx)(e.p,{children:(0,r.jsx)(e.img,{src:s(2305).A+"",width:"1280",height:"598"})}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsxs)(e.p,{children:["\u6dfb\u52a0Panel\u3002\u5207\u6362\u5230Code\u6a21\u5f0f\uff0c\u5728\u8f93\u5165\u6846\u4e2d\u586b\u5199Prometheus expression\uff0c\u4ee5\u76d1\u63a7THUDM/chatglm3-6b\u6a21\u578b\u7684prompt\u5904\u7406\u541e\u5410\u548cgeneration\u5904\u7406\u541e\u5410\u4e3a\u4f8b\uff0c\u5206\u522b\u586b\u5199",(0,r.jsx)(e.code,{children:'stc_llm:avg_prompt_throughput_toks_per_s{model_name="THUDM/chatglm3-6b"}'}),"\u548c",(0,r.jsx)(e.code,{children:'stc_llm:avg_generation_throughput_toks_per_s{model_name="THUDM/chatglm3-6b"}'}),"\uff0c\u5355\u51fb",(0,r.jsx)(e.strong,{children:"Run queries"}),"\u67e5\u770b\u6548\u679c\uff0c\u7136\u540e\u5355\u51fb",(0,r.jsx)(e.strong,{children:"Save"}),"\u3002"]}),"\n",(0,r.jsx)(e.p,{children:(0,r.jsx)(e.img,{src:s(9592).A+"",width:"1280",height:"598"})}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsxs)(e.p,{children:["\u6309\u8981\u6c42\u586b\u5165\u4fe1\u606f\uff0c\u7136\u540e\u5355\u51fb",(0,r.jsx)(e.strong,{children:"Save"}),"\u3002"]}),"\n",(0,r.jsx)(e.p,{children:(0,r.jsx)(e.img,{src:s(4083).A+"",width:"944",height:"314"})}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsx)(e.p,{children:"\u8fdb\u5165\u8fdb\u5165STC_LLM Dashboard\uff0c\u5373\u53ef\u67e5\u770b\u5c55\u793a\u6548\u679c\u3002"}),"\n",(0,r.jsx)(e.p,{children:(0,r.jsx)(e.img,{src:s(3322).A+"",width:"1280",height:"598"})}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(e.h2,{id:"\u751f\u6210\u91cf\u5316\u7cfb\u6570",children:"\u751f\u6210\u91cf\u5316\u7cfb\u6570"}),"\n",(0,r.jsx)(e.p,{children:"SNC\u91cf\u5316\u5de5\u5177\u662f\u57fa\u4e8e\u82f1\u7279\u5c14\u7684Neural Compressor\u6784\u5efa\uff0c\u652f\u6301PyTorch\u5927\u6a21\u578b\u91cf\u5316\u3002Neural Compressor\u662f\u4e00\u4e2a\u5f00\u6e90\u7684Python\u5e93\uff0c\u5b83\u652f\u6301\u5728\u4e3b\u6d41\u6df1\u5ea6\u5b66\u4e60\u6846\u67b6\u4e0a\u5e94\u7528\u6d41\u884c\u7684\u6a21\u578b\u538b\u7f29\u6280\u672f\uff0c\u5305\u62ec\u91cf\u5316\u3001\u526a\u679d\uff08\u7a00\u758f\u6027\uff09\u3001\u84b8\u998f\u548c\u795e\u7ecf\u67b6\u6784\u641c\u7d22\u3002SNC\u91cf\u5316\u5de5\u5177\u652f\u6301\u4ec5\u4f7f\u7528CPU\u8fdb\u884c\u6a21\u578b\u91cf\u5316\u3002"}),"\n",(0,r.jsxs)(e.blockquote,{children:["\n",(0,r.jsxs)(e.p,{children:["\u8bf4\u660e\uff1a\u82e5\u6709ONNX\u5c0f\u6a21\u578b\u91cf\u5316\u9700\u6c42\uff0c\u53ef\u9009\u62e9\u4f7f\u7528SNQ\u6a21\u578b\u91cf\u5316\u5de5\u5177\uff0c\u8be6\u60c5\u53ef\u53c2\u89c1",(0,r.jsx)(e.em,{children:"MLTC\u4f7f\u7528\u6307\u5357"}),"\u3002"]}),"\n"]}),"\n",(0,r.jsx)(e.p,{children:"\u4ee5Qwen2-7B-Instruct\u4e3a\u4f8b\u6f14\u793a\u6267\u884c\u6b65\u9aa4\uff1a"}),"\n",(0,r.jsxs)(e.ol,{children:["\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsx)(e.p,{children:"\u51c6\u5907\u597d\u6570\u636e\u96c6\u548c\u6a21\u578b\u6587\u4ef6\u3002"}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsxs)(e.p,{children:["\u4eceHuggingFace\u7b49\u6e20\u9053\u83b7\u53d6",(0,r.jsx)(e.a,{href:"https://huggingface.co/Qwen/Qwen2-7B-Instruct",children:"Qwen2-7B-Instruct"}),"\u7684\u6587\u4ef6\uff0c\u5305\u62ec\u6a21\u578b\u6587\u4ef6\u3001\u6743\u91cd\u6587\u4ef6\u3001\u5206\u8bcd\u5668\u6587\u4ef6\u3001\u8bcd\u8868\u7b49\uff0c\u5e76\u590d\u5236\u5230\u76ee\u6807\u670d\u52a1\u5668\u3002"]}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsx)(e.p,{children:"\u5c06\u51c6\u5907\u597d\u7684\u6570\u636e\u96c6\u590d\u5236\u5230\u76ee\u6807\u670d\u52a1\u5668\u3002"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsx)(e.p,{children:"\u914d\u7f6eYAML\u6587\u4ef6\u3002"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-bash",children:'# \u7528\u4e8e\u62c9\u5e73\u6fc0\u6d3b\u503c\u4e0e\u6743\u91cd\u7684\u8d85\u53c2\u6570\u5217\u8868\nalpha_list: [0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7, 0.8, 0.9]\n\n# \u6570\u636e\u96c6\u4f4d\u7f6e\u8def\u5f84\ndata_path: "./ceval-exam/val"\n\n# \u6a21\u578b\u4f4d\u7f6e\u8def\u5f84\nmodel_path : "qwen2-7b-instruct"\n\n#\u6bcf\u4e2a\u6570\u636e\u96c6\u5b50\u96c6\u53d6\u591a\u5c11\u4e2a\u6570\u636e\u8fdb\u884c\u91cf\u5316\ncalib_size : 1 \n\n# \u8fd0\u884c\u8bbe\u5907\uff0c\u652f\u6301CPU\u548cGPU\uff0c\u53d6\u503c\u5206\u522b\u4e3acpu\u548ccuda\u3002\ndevice : "cpu"\n\n# \u5c42\u6570\nlayers: 28\n\n# attention\u4e2d\u6709\u540c\u4e00\u8f93\u5165\u7684linear\u5c42\u540d\uff0c\u53ef\u4ee5\u5728model.safetensors.index.json\u4e2d\u67e5\u770b\uff0c\nqkv: ["model.layers.{}.self_attn.q_proj", "model.layers.{}.self_attn.k_proj", "model.layers.{}.self_attn.v_proj"]\n\n# MLP\u4e2d\u6709\u540c\u4e00\u8f93\u5165\u7684linear\u5c42\u540d\nup_gate: ["model.layers.{}.mlp.up_proj", "model.layers.{}.mlp.gate_proj"]\n\n# \u4fdd\u5b58scale\u8def\u5f84\uff0c\u8fd9\u91cc\u9700\u8981\u5b8c\u6574\u7684\u7edd\u5bf9\u8def\u5f84\uff0c\u8def\u5f84\u4e2d\u4e0d\u53ef\u4f7f\u7528\u2018~\u2019\nscale_path: "/root/snc/qwen2_7b_zwt"\n'})}),"\n",(0,r.jsx)(e.p,{children:"Qwen2-7B-Instruct\u6a21\u578b\u7684\u5c42\u6570\u3001qkv\u548cup_gate\u5bf9\u5e94\u503c\u53ef\u4ee5\u6a21\u578b\u7684\u914d\u7f6e\u6587\u4ef6\u4e2d\u67e5\u8be2\u3002"}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsx)(e.p,{children:"layers\u5bf9\u5e94\u7684\u662f\u6a21\u578b\u5c42\u6570\u3002"}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsxs)(e.p,{children:["qkv\u5bf9\u5e94\u7684\u662fattention\u4e2d\u6709\u540c\u4e00\u8f93\u5165\u7684linear\u5c42\u540d\u3002\u8fd9\u4e9b\u540d\u79f0\u662f\u57fa\u4e8e",(0,r.jsx)(e.code,{children:"model.safetensors.index.json"}),"\u6587\u4ef6\u4e2d\u7684\u8282\u70b9\u540d\u79f0\u8fdb\u884c\u8f6c\u6362\u7684\u3002\u8f6c\u6362\u8fc7\u7a0b\u5305\u62ec\u5c06\u8282\u70b9\u540d\u79f0\u4e2d\u7684\u5c42\u7f16\u53f7\u66ff\u6362\u4e3a\u5360\u4f4d\u7b26",(0,r.jsx)(e.code,{children:"{}"}),"\uff0c\u5e76\u7701\u7565\u6389",(0,r.jsx)(e.code,{children:"o_proj"}),"\u3001",(0,r.jsx)(e.code,{children:"down_proj"}),"\u3001",(0,r.jsx)(e.code,{children:"bias"}),"\u3001",(0,r.jsx)(e.code,{children:"weight"}),"\u7b49\u540e\u7f00\u3002\u4f8b\u5982\uff0c\u5982\u679c\u539f\u59cb\u8282\u70b9\u540d\u79f0\u662f",(0,r.jsx)(e.code,{children:"model.layers.0.self_attn.k_proj.bias"}),"\uff0c\u90a3\u4e48\u5728",(0,r.jsx)(e.code,{children:"qkv"}),"\u53c2\u6570\u4e2d\u5bf9\u5e94\u7684\u540d\u79f0\u5c31\u4f1a\u662f",(0,r.jsx)(e.code,{children:"model.layers.{}.self_attn.k_proj"}),"\u3002"]}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsxs)(e.p,{children:["up_gate\u5bf9\u5e94\u7684\u662fMLP\u4e2d\u6709\u540c\u4e00\u8f93\u5165\u7684linear\u5c42\u540d\uff0c\u4f46\u4e0d\u5305\u62ecdown_proj\u7ec4\u4ef6\u3002\u8fd9\u4e2a\u540d\u79f0\u662f\u6839\u636e",(0,r.jsx)(e.code,{children:"model.safetensors.index.json"}),"\u6587\u4ef6\u4e2d\u7684\u8282\u70b9\u540d\u79f0\u8f6c\u6362\u800c\u6765\u7684\u3002\u8f6c\u6362\u89c4\u5219\u662f\u5c06\u8282\u70b9\u540d\u79f0\u4e2d\u7684\u5c42\u7f16\u53f7\u66ff\u6362\u4e3a\u5360\u4f4d\u7b26",(0,r.jsx)(e.code,{children:"{}"}),"\uff0c\u5e76\u79fb\u9664\u540d\u79f0\u4e2d\u7684",(0,r.jsx)(e.code,{children:"weight"}),"\u90e8\u5206\u3002\u4f8b\u5982\uff0c\u5982\u679c\u539f\u59cb\u8282\u70b9\u540d\u79f0\u662f",(0,r.jsx)(e.code,{children:"model.layers.0.mlp.gate_proj.weight"}),"\uff0c\u90a3\u4e48",(0,r.jsx)(e.code,{children:"up_gate"}),"\u5bf9\u5e94\u7684\u540d\u79f0\u5c06\u53d8\u4e3a",(0,r.jsx)(e.code,{children:"model.layers.{}.mlp.gate_proj"}),"\u3002"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsx)(e.p,{children:"\u8bbe\u7f6e\u73af\u5883\u53d8\u91cf\uff0c\u4f7f\u7528SQEX\u8bbe\u7f6eYAML\u6587\u4ef6\u7684\u5b58\u653e\u76ee\u5f55\u3002\u8def\u5f84\u5fc5\u987b\u4e3a\u7edd\u5bf9\u8def\u5f84\u3002"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-bash",children:"$ export SQEX=/root/snc/sqex.yaml\n"})}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsx)(e.p,{children:"\u542f\u52a8\u91cf\u5316\u5de5\u5177\u811a\u672c\u3002"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-bash",children:"$ run_quant_no_eval\n"})}),"\n",(0,r.jsxs)(e.p,{children:["\u5728\u8bbe\u7f6e\u7684scale\u8def\u5f84\u4e0b\u4f1a\u751f\u6210\u5bf9\u5e94\u8d85\u53c2\u6570\u7684\u6240\u6709\u5019\u9009\u7684\u91cf\u5316\u7f29\u653e\u7cfb\u6570\u3002\u6587\u4ef6\u540d\u7531",(0,r.jsx)(e.code,{children:"sq"}),"+\u8d85\u53c2\u6570\u7ec4\u5408\uff0csq\u662fsmooth quant\u7684\u7b80\u79f0\u3002smooth quant\u662f\u4e00\u79cd\u62c9\u5e73\u6fc0\u6d3b\u503c\u6765\u51cf\u5c11\u7cbe\u5ea6\u635f\u5931\u7684\u7b97\u6cd5\u3002"]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-bash",children:"$ cd /root/snc/qwen2_7b_zwt\n$ tree\n.\n\u251c\u2500\u2500 sq_0.1\n\u2502\xa0\xa0 \u251c\u2500\u2500 act_scale_mlp_up_gate_v_w.npy\n\u2502\xa0\xa0 \u251c\u2500\u2500 act_scale_mlp_up_gate_w.npy\n\u2502\xa0\xa0 \u251c\u2500\u2500 act_scale_qkv_v_w.npy\n\u2502\xa0\xa0 \u2514\u2500\u2500 act_scale_qkv_w.npy\n\u251c\u2500\u2500 sq_0.2\n\u2502\xa0\xa0 \u251c\u2500\u2500 act_scale_mlp_up_gate_v_w.npy\n\u2502\xa0\xa0 \u251c\u2500\u2500 act_scale_mlp_up_gate_w.npy\n\u2502\xa0\xa0 \u251c\u2500\u2500 act_scale_qkv_v_w.npy\n\u2502\xa0\xa0 \u2514\u2500\u2500 act_scale_qkv_w.npy\n\u251c\u2500\u2500 sq_0.3\n\u2502\xa0\xa0 \u251c\u2500\u2500 act_scale_mlp_up_gate_v_w.npy\n\u2502\xa0\xa0 \u251c\u2500\u2500 act_scale_mlp_up_gate_w.npy\n\u2502\xa0\xa0 \u251c\u2500\u2500 act_scale_qkv_v_w.npy\n\u2502\xa0\xa0 \u2514\u2500\u2500 act_scale_qkv_w.npy\n\u251c\u2500\u2500 sq_0.4\n\u2502\xa0\xa0 \u251c\u2500\u2500 act_scale_mlp_up_gate_v_w.npy\n\u2502\xa0\xa0 \u251c\u2500\u2500 act_scale_mlp_up_gate_w.npy\n\u2502\xa0\xa0 \u251c\u2500\u2500 act_scale_qkv_v_w.npy\n\u2502\xa0\xa0 \u2514\u2500\u2500 act_scale_qkv_w.npy\n\u251c\u2500\u2500 sq_0.5\n\u2502\xa0\xa0 \u251c\u2500\u2500 act_scale_mlp_up_gate_v_w.npy\n\u2502\xa0\xa0 \u251c\u2500\u2500 act_scale_mlp_up_gate_w.npy\n\u2502\xa0\xa0 \u251c\u2500\u2500 act_scale_qkv_v_w.npy\n\u2502\xa0\xa0 \u2514\u2500\u2500 act_scale_qkv_w.npy\n\u251c\u2500\u2500 sq_0.6\n\u2502\xa0\xa0 \u251c\u2500\u2500 act_scale_mlp_up_gate_v_w.npy\n\u2502\xa0\xa0 \u251c\u2500\u2500 act_scale_mlp_up_gate_w.npy\n\u2502\xa0\xa0 \u251c\u2500\u2500 act_scale_qkv_v_w.npy\n\u2502\xa0\xa0 \u2514\u2500\u2500 act_scale_qkv_w.npy\n\u251c\u2500\u2500 sq_0.7\n\u2502\xa0\xa0 \u251c\u2500\u2500 act_scale_mlp_up_gate_v_w.npy\n\u2502\xa0\xa0 \u251c\u2500\u2500 act_scale_mlp_up_gate_w.npy\n\u2502\xa0\xa0 \u251c\u2500\u2500 act_scale_qkv_v_w.npy\n\u2502\xa0\xa0 \u2514\u2500\u2500 act_scale_qkv_w.npy\n\u251c\u2500\u2500 sq_0.8\n\u2502\xa0\xa0 \u251c\u2500\u2500 act_scale_mlp_up_gate_v_w.npy\n\u2502\xa0\xa0 \u251c\u2500\u2500 act_scale_mlp_up_gate_w.npy\n\u2502\xa0\xa0 \u251c\u2500\u2500 act_scale_qkv_v_w.npy\n\u2502\xa0\xa0 \u2514\u2500\u2500 act_scale_qkv_w.npy\n\u2514\u2500\u2500 sq_0.9\n    \u251c\u2500\u2500 act_scale_mlp_up_gate_v_w.npy\n    \u251c\u2500\u2500 act_scale_mlp_up_gate_w.npy\n    \u251c\u2500\u2500 act_scale_qkv_v_w.npy\n    \u2514\u2500\u2500 act_scale_qkv_w.npy\n"})}),"\n",(0,r.jsxs)(e.p,{children:["\u5176\u4e2d\u6587\u4ef6\u540d\u540e\u7f00\u4e3a",(0,r.jsx)(e.code,{children:"_v_w"}),"\u7684\u6587\u4ef6\u4e2d\u5b58\u653e\u7740\u5bf9\u5e94\u8d85\u53c2\u6570\u7684\u6fc0\u6d3b\u5c42\u7684smooth_quant\u7cfb\u6570\uff0c",(0,r.jsx)(e.code,{children:"_w"}),"\u7684\u6587\u4ef6\u4e2d\u5b58\u653e\u7740\u5bf9\u5e94\u8d85\u53c2\u6570\u7684\u6bcf\u5c42pertensor\u7cfb\u6570\u3002"]}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsxs)(e.p,{children:["\u540e\u7eed\u53ef\u53c2\u8003",(0,r.jsx)(e.em,{children:"\u672c\u5730\u9a8c\u8bc1\u6a21\u578b"}),"\u7ae0\u8282\u4e2d\u7684\u793a\u4f8b\uff0c\u5bf9\u540c\u4e00\u4e2a\u6a21\u578b\u5e94\u7528\u4e0d\u540c\u7684\u91cf\u5316\u7cfb\u6570\u5206\u6790\u7cbe\u5ea6\uff0c\u4ece\u4e2d\u9009\u51fa\u7cbe\u5ea6\u6700\u4f18\u7684\u91cf\u5316\u7f29\u653e\u7cfb\u6570\u3002\u5c06scale\u76ee\u5f55\u4e0b\u7684\u91cf\u5316\u7cfb\u6570\u6587\u4ef6\u653e\u6a21\u578b\u914d\u7f6e\u4e2doriginal_weight_dir\u53c2\u6570\u6307\u5b9a\u7684\u76ee\u5f55\u4e0b\uff0c\u540c\u65f6quant_type\u914d\u7f6e\u8bbe\u4e3a",(0,r.jsx)(e.code,{children:"w8a8"}),"\u3002"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(e.h2,{id:"\u672c\u5730\u9a8c\u8bc1\u6a21\u578b",children:"\u672c\u5730\u9a8c\u8bc1\u6a21\u578b"}),"\n",(0,r.jsx)(e.p,{children:"\u6211\u4eec\u652f\u6301\u624b\u5199\u5927\u6a21\u578b\u548cMLTC\u7f16\u8bd1\u5927\u6a21\u578b\uff0c\u60a8\u53ef\u5148\u5728\u672c\u5730\u90e8\u7f72\u9a8c\u8bc1\u6a21\u578b\u3002"}),"\n",(0,r.jsx)(e.h3,{id:"\u624b\u5199\u5927\u6a21\u578b",children:"\u624b\u5199\u5927\u6a21\u578b"}),"\n",(0,r.jsx)(e.p,{children:"\u4ee5chatglm3-6b\u4e3a\u4f8b\u6f14\u793a\u90e8\u7f72\u624b\u5199\u5927\u6a21\u578b\u6b65\u9aa4\uff1a"}),"\n",(0,r.jsxs)(e.ol,{children:["\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsx)(e.p,{children:"\u8bbe\u7f6e\u73af\u5883\u53d8\u91cf\u3002"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-bash",children:"$ export RISCV=/usr/local/hpe\n"})}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsxs)(e.p,{children:["\u4eceHuggingFace\u7b49\u6e20\u9053\u83b7\u53d6",(0,r.jsx)(e.a,{href:"https://huggingface.co/THUDM/chatglm3-6b/tree/main",children:"chatglm3-6b"}),"\u7684\u6587\u4ef6\uff0c\u5305\u62ec\u6a21\u578b\u6587\u4ef6\u3001\u6743\u91cd\u6587\u4ef6\u3001\u5206\u8bcd\u5668\u6587\u4ef6\u3001\u8bcd\u8868\u7b49\uff0c\u5e76\u590d\u5236\u5230\u76ee\u6807\u670d\u52a1\u5668\u3002"]}),"\n",(0,r.jsx)(e.p,{children:(0,r.jsx)(e.img,{src:s(1083).A+"",width:"1280",height:"723"})}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(e.ol,{start:"3",children:["\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsx)(e.p,{children:"\u7f16\u5199Python\u811a\u672c\u90e8\u7f72\u5e76\u9a8c\u8bc1\u6a21\u578b\u3002\u811a\u672c\u793a\u4f8b\u4e2d\u4e3b\u8981\u5305\u62ec\u4ee5\u4e0b\u6b65\u9aa4\uff1a"}),"\n",(0,r.jsxs)(e.ol,{children:["\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsxs)(e.p,{children:["\u51c6\u5907\u6a21\u578b\u914d\u7f6e\uff0c\u652f\u6301\u7684\u914d\u7f6e\u9879\u8bf7\u53c2\u89c1",(0,r.jsx)(e.em,{children:"\u6a21\u578b\u914d\u7f6e"}),"\u7ae0\u8282\u3002"]}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsxs)(e.p,{children:["\u8c03\u7528",(0,r.jsx)(e.code,{children:"AsyncGeneration"}),"\u63a5\u53e3\u90e8\u7f72\u6a21\u578b\u3002"]}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsx)(e.p,{children:"\u53d1\u9001messages\u9a8c\u8bc1LLM\u7684\u5bf9\u8bdd\u6548\u679c\u3002"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-bash",children:'$ cat test_chatglm3-6b.py\nimport asyncio\n\nfrom stc_llm_dnn.runtime import AsyncGeneration\n\nasync def print_stream(gen, model, gen_name, prompt):\n    async for task in gen:\n        print("[{}] prompt = {}, gen = {}".format(gen_name, prompt, model.decode_token_ids(task.gen_tokens)))\n\nasync def test_async_generation():\n    # \u914d\u7f6e\u4fe1\u606f\n    config = {\n        "model_name": "THUDM/chatglm3-6b",           # \u6a21\u578b\u540d\u79f0\n        "devices": [0, 1],                           # \u4f7f\u7528\u7684 npu id \u5217\u8868\n        "tok_dir": "./chatglm3-6b",             # tokenizer \u76ee\u5f55\n        "original_weight_dir": "./chatglm3-6b", # \u539f\u59cb\u6743\u91cd\u8def\u5f84\n        "weight_dir": "chatglm2-6b-2npu-dataset",    # \u8f6c\u6362\u540e\u6743\u91cd\u8def\u5f84\n        "max_tasks": 256,\n        "custom_parameters": True,\n        "quant_type": "fp16",\n        "compress_factor": 1,\n    }\n\n    # \u521b\u5efa generation\n    generation = AsyncGeneration(config)\n\n    # \u8fd0\u884c\u6d4b\u8bd5\n    messages = [\n        {"role": "system", "content": "\u4f60\u662f\u8d44\u6df1\u7684\u6280\u672f\u652f\u6301\u4e13\u5bb6\uff0c\u53ef\u4ee5\u4e3a\u7528\u6237\u63d0\u4f9b\u8f6f\u786c\u4ef6\u4ea7\u54c1\u7684\u6280\u672f\u652f\u6301\uff0c\u89e3\u7b54\u7528\u6237\u4f7f\u7528\u4ea7\u54c1\u65f6\u7684\u7591\u95ee\u3002"},\n        {"role": "user", "content": "\u4f60\u597d\uff0c\u4f60\u662f\u8c01\u554a\uff1f"},\n    ]\n    task = await generation.create_task(messages=messages, temperature=0.5, top_p=0.2, top_k=20, max_output_len=256)\n    gen = generation.generate_stream(task)\n    user_task = asyncio.create_task(print_stream(gen, generation.model, f"gen", "\u4f60\u597d"))\n    await user_task\n\n    await generation.shutdown()\n\nif __name__ == "__main__":\n    asyncio.run(test_async_generation())\n    \n$ python3 test_chatglm3-6b.py\n# \u5ffd\u7565\u90e8\u5206\u56de\u663e\n\n---------------------------- Model Info Begin ----------------------------\nmodel name: THUDM/chatglm3-6b\nnpus: [0, 1]\ntotal slot number: 157053\nslot number per segment: 256\ntotal segment number: 613\nbytes per slot: 14336\ntemporary cpp dir: /home/superadmin/.cache/stc_llm_dnn/THUDM/chatglm3-6b\ntokenizer dir: ./chatglm3-6b\nweight dir: chatglm2-6b-2npu-dataset\nembedding on host: False\noutput on host: False\ndma preload: True\nmax sequence length: 8192\ncompress_factor: 1\nquant_type: fp16\n---------------------------- Model Info End ----------------------------\n\n# \u5ffd\u7565\u90e8\u5206\u56de\u663e\n\n[gen] prompt = \u4f60\u597d, gen =\n \u4f60\u597d\uff0c\u6211\u662f\u8d44\u6df1\u6280\u672f\u652f\u6301\u4e13\u5bb6\uff0c\u5f88\u9ad8\u5174\u4e3a\u60a8\u63d0\u4f9b\u6280\u672f\u652f\u6301\u3002\u8bf7\u95ee\u6709\u4ec0\u4e48\u8f6f\u786c\u4ef6\u4ea7\u54c1\u9700\u8981\u6211\u5e2e\u52a9\u60a8\u89e3\u7b54\u7591\u95ee\u5417\uff1f\n'})}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(e.h3,{id:"mltc\u7f16\u8bd1\u5927\u6a21\u578b",children:"MLTC\u7f16\u8bd1\u5927\u6a21\u578b"}),"\n",(0,r.jsxs)(e.ol,{children:["\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsx)(e.p,{children:"\u8bbe\u7f6e\u73af\u5883\u53d8\u91cf\u3002"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-bash",children:"$ export RISCV=/usr/local/hpe\n"})}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsxs)(e.p,{children:["\u4eceHuggingFace\u7b49\u6e20\u9053\u83b7\u53d6",(0,r.jsx)(e.a,{href:"https://huggingface.co/Qwen/Qwen2-7B-Instruct",children:"Qwen2-7B-Instruct"}),"\u7684\u6587\u4ef6\uff0c\u5305\u62ec\u5305\u62ec\u6a21\u578b\u6587\u4ef6\u3001\u6743\u91cd\u6587\u4ef6\u3001\u5206\u8bcd\u5668\u6587\u4ef6\u3001\u8bcd\u8868\u7b49\uff0c\u5e76\u590d\u5236\u5230\u76ee\u6807\u670d\u52a1\u5668\u3002"]}),"\n",(0,r.jsx)(e.p,{children:(0,r.jsx)(e.img,{src:s(9917).A+"",width:"1280",height:"694"})}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsx)(e.p,{children:"\u7f16\u5199Python\u811a\u672c\u90e8\u7f72\u5e76\u9a8c\u8bc1\u6a21\u578b\u3002\u811a\u672c\u793a\u4f8b\u4e2d\u4e3b\u8981\u5305\u62ec\u4ee5\u4e0b\u6b65\u9aa4\uff1a"}),"\n",(0,r.jsxs)(e.ol,{children:["\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsxs)(e.p,{children:["\u51c6\u5907\u6a21\u578b\u914d\u7f6e\uff0c\u652f\u6301\u7684\u914d\u7f6e\u9879\u8bf7\u53c2\u89c1",(0,r.jsx)(e.em,{children:"\u6a21\u578b\u914d\u7f6e"}),"\u7ae0\u8282\u3002"]}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsxs)(e.p,{children:["\u8c03\u7528",(0,r.jsx)(e.code,{children:"AsyncGeneration"}),"\u63a5\u53e3\u90e8\u7f72\u6a21\u578b\u3002"]}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsx)(e.p,{children:"\u53d1\u9001messages\u9a8c\u8bc1LLM\u7684\u5bf9\u8bdd\u6548\u679c\u3002"}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-bash",children:'$ cat test_qwen2-7b-instruct.py\nimport asyncio\nfrom stc_llm_mltc.runtime import AsyncGeneration\n\nasync def test_run():\n    config = {\n        "model_name": "Qwen/Qwen2-7B-Instruct",\n        "devices": [0, 1],\n        "tok_dir": "/model/qwen2-7b-instruct/",\n        "mltc_weight_dir": "/model/qwen2-7b-instruct-weight/qwen2-7b-32heads-mask-28layers",\n    }\n    prompt = "\u4f60\u662f\u4e00\u4e2a\u5199\u4f5c\u5c0f\u52a9\u624b\uff0c\u8bf7\u5e2e\u5fd9\u5199\u4e00\u7bc7\u63cf\u8ff0\u6c5f\u5357\u6625\u5929\u957f\u5ea6\u4e0d\u5c11\u4e8e1024\u4e2atoken\u7684\u5c0f\u4f5c\u6587\uff0c\u8981\u6c42\u5176\u4e2d\u5fc5\u987b\u6d89\u53ca\u5230\u63cf\u8ff0\u6726\u80e7\u7684\u70df\u96e8\uff0c\u873f\u8712\u7684\u77f3\u677f\u5c0f\u8def\u7b49\u666f\u7269\uff0c\u540c\u65f6\u65e2\u8981\u63cf\u5199\u51fa\u9633\u5149\u660e\u5a9a\u3001\u98ce\u548c\u65e5\u4e3d\u7684\u573a\u666f\uff0c\u4e5f\u8981\u63cf\u8ff0\u51fa\u70df\u96e8\u7ef5\u7ef5\u3001\u4e91\u6c14\u6c24\u6c32\u7684\u573a\u666f\u3002\u7136\u540e\u6587\u7ae0\u4e2d\u9700\u8981\u5305\u542b\u6392\u6bd4\u3001\u6bd4\u55bb\u3001\u5bf9\u5076\u3001\u62df\u4eba\u7b49\u4fee\u8f9e\u624b\u6cd5\uff0c\u5fc5\u8981\u65f6\u53ef\u4ee5\u5f15\u7528\u4e00\u4e9b\u7b26\u5408\u6587\u7ae0\u4e3b\u9898\u8bed\u5883\u7684\u53e4\u8bd7\u8bcd\u4e2d\u7684\u53e5\u5b50\u4ee5\u589e\u52a0\u6587\u91c7\u3002"\n    generation = AsyncGeneration(config)\n    task = await generation.create_task(prompt=prompt, max_output_len=5)\n    async for _ in generation.generate_stream(task):\n        toks = task.gen_tokens[task.return_offset :]\n        task.return_offset += len(toks)\n        if len(toks) == 0:\n            continue\n        text = generation.tokenizer.decode(toks)\n        print(text, end=" ", flush=True)\n\nasyncio.run(test_run())\n    \n$ python3 test_qwen2-7b-instruct.py\n# \u5ffd\u7565\u90e8\u5206\u56de\u663e\n\nTo enable the following instructions: AVX2 FMA, in other operations, rebuild TensorFlow with the appropriate compiler flags.\n\u6c5f\u5357\u7684\u6625\u5929\uff0c\u5982\u540c\u4e00\u4f4d\u7f9e\u6da9\u7684\u5c11\u5973\uff0c\u8f7b\u542f\u6731\u5507\uff0c\u5410\u9732\u7740\u6e29\u67d4\u7684\u6c14\u606f\u3002\u5979\u4ee5\u4e00\u79cd\u96be\u4ee5\u8a00\u55bb\u7684\u7f8e\uff0c\u7f13\u7f13\u94fa\u5c55\u5f00\u4e00\u5e45\u5e45\u7ec6\u817b\u7684\u753b\u5377\uff0c\u8ba9\u4eba\u5fc3\u9189\u795e\u8ff7\u3002\u5728\u8fd9\u7247\u571f\u5730\u4e0a\uff0c\u6625\u5929\u7684\u957f\u5ea6\u4eff\u4f5b\u88ab\u65f6\u95f4\u7684\u7b14\u89e6\u62c9\u957f\uff0c\u6bcf\u4e00\u523b\u90fd\u5145\u6ee1\u4e86\u8bd7\u610f\u4e0e\u751f\u673a\u3002\n\n\u70df\u96e8\u662f\u6c5f\u5357\u6625\u5929\u7684\u9b42\u9b44\uff0c\u5b83\u8f7b\u67d4\u5730\u62c2\u8fc7\u6bcf\u4e00\u5bf8\u571f\u5730\uff0c\u4e3a\u5927\u5730\u62ab\u4e0a\u4e86\u4e00\u5c42\u8584\u8584\u7684\u8f7b\u7eb1\u3002\u90a3\u70df\u96e8\uff0c\u5982\u540c\u7ec6\u4e1d\u822c\u7f20\u7ed5\u5728\u53e4\u8001\u7684\u77f3\u677f\u5c0f\u8def\u4e0a\uff0c\u873f\u8712\u66f2\u6298\uff0c\u4eff\u4f5b\u662f\u5927\u81ea\u7136\u7684\u7b14\u89e6\uff0c\u52fe\u52d2\u51fa\u4e00\u5e45\u5e45\u6c34\u58a8\u753b\u3002\u96e8\u6ef4\u843d\u5728\u9752\u77f3\u677f\u4e0a\uff0c\u53d1\u51fa\u6e05\u8106\u7684\u54cd\u58f0\uff0c\u5982\u540c\u53e4\u7434\u7684\u4f4e\u541f\uff0c\u60a0\u626c\u800c\u6df1\u9083\u3002\u8fd9\u70df\u96e8\uff0c\u662f\u6c5f\u5357\u6625\u5929\u7684\u5e8f\u66f2\uff0c\u5b83\u4ee5\u4e00\u79cd\u6726\u80e7\u800c\u795e\u79d8\u7684\u65b9\u5f0f\uff0c\u5524\u9192\u4e86\u6c89\u7761\u7684\u5927\u5730\uff0c\u8ba9\u4e07\u7269\u5728\u6e7f\u6da6\u4e2d\u82cf\u9192\u3002\n\n\u9633\u5149\u660e\u5a9a\u7684\u65e5\u5b50\uff0c\u6c5f\u5357\u7684\u6625\u5929\u5219\u5c55\u73b0\u51fa\u53e6\u4e00\u756a\u666f\u8c61\u3002\u9633\u5149\u5982\u540c\u91d1\u8272\u7684\u4e1d\u7ebf\uff0c\u7a7f\u900f\u4e91\u5c42\uff0c\u6d12\u5728\u5927\u5730\u4e0a\uff0c\u7ed9\u4e07\u7269\u62ab\u4e0a\u4e86\u4e00\u5c42\u91d1\u8272\u7684\u5916\u8863\u3002\u5fae\u98ce\u8f7b\u62c2\uff0c\u5e26\u7740\u82b1\u9999\u4e0e\u6ce5\u571f\u7684\u82ac\u82b3\uff0c\u8ba9\u4eba\u611f\u5230\u5fc3\u65f7\u795e\u6021\u3002\u5728\u8fd9\u6e29\u6696\u7684\u9633\u5149\u4e0b\uff0c\u5c0f\u6eaa\u6f7a\u6f7a\uff0c\u67f3\u6811\u8f7b\u6447\uff0c\u4eff\u4f5b\u5728\u8bc9\u8bf4\u7740\u6625\u5929\u7684\u6545\u4e8b\u3002\u8fd9\u9633\u5149\uff0c\u662f\u6c5f\u5357\u6625\u5929\u7684\u4e3b\u65cb\u5f8b\uff0c\u5b83\u4ee5\u4e00\u79cd\u660e\u4eae\u800c\u6e29\u6696\u7684\u65b9\u5f0f\uff0c\u7167\u4eae\u4e86\u5927\u5730\uff0c\u8ba9\u4e16\u754c\u5145\u6ee1\u4e86\u751f\u673a\u4e0e\u6d3b\u529b\u3002\n\n\u5728\u8fd9\u7247\u571f\u5730\u4e0a\uff0c\u6625\u5929\u7684\u7f8e\u662f\u591a\u7ef4\u5ea6\u7684\uff0c\u65e2\u6709\u70df\u96e8\u7684\u6726\u80e7\uff0c\u4e5f\u6709\u9633\u5149\u7684\u660e\u5a9a\u3002\u5b83\u4eec\u4ea4\u7ec7\u5728\u4e00\u8d77\uff0c\u5982\u540c\u4e00\u5e45\u52a8\u4eba\u7684\u753b\u5377\uff0c\u8ba9\u4eba\u6c89\u9189\u5176\u4e2d\u3002\u6b63\u5982\u5510\u4ee3\u8bd7\u4eba\u675c\u752b\u6240\u8a00\uff1a\u201c\u597d\u96e8\u77e5\u65f6\u8282\uff0c\u5f53\u6625\u4e43\u53d1\u751f\u3002\u968f\u98ce\u6f5c\u5165\u591c\uff0c\u6da6\u7269\u7ec6\u65e0\u58f0\u3002\u201d\u8fd9\u6b63\u662f\u6c5f\u5357\u6625\u5929\u7684\u5199\u7167\uff0c\u5b83\u5728\u4e0d\u7ecf\u610f\u95f4\uff0c\u4ee5\u4e00\u79cd\u6da6\u7269\u7ec6\u65e0\u58f0\u7684\u65b9\u5f0f\uff0c\u5c06\u7f8e\u4e0e\u5e0c\u671b\u64ad\u6492\u5728\u5927\u5730\u4e0a\u3002\n\n\u6c5f\u5357\u7684\u6625\u5929\uff0c\u662f\u4e00\u9996\u8bd7\uff0c\u662f\u4e00\u5e45\u753b\uff0c\u66f4\u662f\u4e00\u6bb5\u65c5\u7a0b\u3002\u5728\u8fd9\u6bb5\u65c5\u7a0b\u4e2d\uff0c\u6bcf\u4e00\u5904\u666f\u81f4\u90fd\u5145\u6ee1\u4e86\u8bd7\u610f\u4e0e\u54f2\u601d\uff0c\u8ba9\u4eba\u5728\u6b23\u8d4f\u4e4b\u4f59\uff0c\u4e5f\u80fd\u611f\u53d7\u5230\u751f\u547d\u7684\u7f8e\u597d\u4e0e\u5e0c\u671b\u3002\u6625\u5929\u7684\u6c5f\u5357\uff0c\u4ee5\u5176\u72ec\u7279\u7684\u9b45\u529b\uff0c\u5438\u5f15\u7740\u65e0\u6570\u4eba\u524d\u6765\u63a2\u5bfb\uff0c\u611f\u53d7\u90a3\u4efd\u5c5e\u4e8e\u6625\u5929\u7684\u6e29\u67d4\u4e0e\u529b\u91cf\u3002 <|im_end|>\n\n'})}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(e.h3,{id:"\u6a21\u578b\u914d\u7f6e",children:"\u6a21\u578b\u914d\u7f6e"}),"\n",(0,r.jsxs)(e.table,{children:[(0,r.jsx)(e.thead,{children:(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.th,{children:(0,r.jsx)(e.strong,{children:"\u914d\u7f6e\u9879"})}),(0,r.jsx)(e.th,{children:(0,r.jsx)(e.strong,{children:"\u662f\u5426\u5fc5\u586b"})}),(0,r.jsx)(e.th,{children:(0,r.jsx)(e.strong,{children:"\u6570\u636e\u7c7b\u578b"})}),(0,r.jsx)(e.th,{children:(0,r.jsx)(e.strong,{children:"\u63cf\u8ff0"})})]})}),(0,r.jsxs)(e.tbody,{children:[(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"model_name"}),(0,r.jsx)(e.td,{children:"\u662f"}),(0,r.jsx)(e.td,{children:"str"}),(0,r.jsx)(e.td,{children:"\u5f85\u90e8\u7f72\u6a21\u578b\u7684\u540d\u79f0\uff0c\u5efa\u8bae\u4e0eHuggingFace\u7b49\u6e20\u9053\u4e2d\u7684\u540d\u79f0\u4fdd\u6301\u4e00\u81f4\u3002"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"devices"}),(0,r.jsx)(e.td,{children:"\u662f"}),(0,r.jsx)(e.td,{children:"list"}),(0,r.jsx)(e.td,{children:"\u6a21\u578b\u63a8\u7406\u65f6\u5360\u7528NPU\u8bbe\u5907\u7684ID\u5217\u8868\uff0cSTC_LLM\u4f1a\u6839\u636eNPU\u8bbe\u5907\u7684\u6570\u91cf\u5c06\u539f\u59cb\u6743\u91cd\u81ea\u52a8\u5207\u5206\u4e3a\u5339\u914d\u7684\u4efd\u6570\u3002"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"tok_dir"}),(0,r.jsx)(e.td,{children:"\u662f"}),(0,r.jsx)(e.td,{children:"str"}),(0,r.jsx)(e.td,{children:"\u52a0\u8f7d\u6a21\u578b\u7684\u5206\u8bcd\u5668\uff08tokenizer\uff09\u6587\u4ef6\u7684\u8def\u5f84\u3002"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"original_weight_dir"}),(0,r.jsx)(e.td,{children:"\u5426"}),(0,r.jsx)(e.td,{children:"str"}),(0,r.jsxs)(e.td,{children:["\u52a0\u8f7d\u6a21\u578b\u7684\u539f\u59cb\u6743\u91cd\u6587\u4ef6\u7684\u8def\u5f84\u3002\u5982\u679c\u60a8\u6ca1\u6709\u5728\u76ee\u6807\u670d\u52a1\u5668\u4e0a\u8f6c\u6362\u8fc7\u6743\u91cd\uff0c\u5219\u81f3\u5c11\u9700\u8981\u4ece\u539f\u59cb\u6743\u91cd\u8f6c\u6362\u4e00\u6b21\uff0c\u8fd9\u65f6",(0,r.jsx)(e.code,{children:"original_weight_dir"}),"\u4e3a\u5fc5\u586b\u9879\u3002"]})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"weight_dir"}),(0,r.jsx)(e.td,{children:"\u5426"}),(0,r.jsx)(e.td,{children:"str"}),(0,r.jsxs)(e.td,{children:["\u4ece\u539f\u59cb\u6743\u91cd\u8f6c\u6362\u540e\u53ef\u4ee5\u5728NPU\u8bbe\u5907\u4e0a\u4f7f\u7528\u7684\u6743\u91cd\u7684\u8def\u5f84\u3002",(0,r.jsx)("br",{}),"- \u5982\u679c",(0,r.jsx)(e.code,{children:"weight_dir"}),"\u6307\u5411\u7684\u8def\u5f84\u5b58\u5728\u6743\u91cd\u6587\u4ef6\uff0c\u5219\u4f7f\u7528\u8fd9\u4e9b\u6743\u91cd\u3002",(0,r.jsx)("br",{}),"- \u5982\u679c",(0,r.jsx)(e.code,{children:"weight_dir"}),"\u6307\u5411\u7684\u8def\u5f84\u4e0d\u5b58\u5728\u6743\u91cd\u6587\u4ef6\uff0c\u5219STC_LLM\u5c1d\u8bd5\u4ece",(0,r.jsx)(e.code,{children:"original_weight_dir"}),"\u83b7\u53d6\u539f\u59cb\u6743\u91cd\u8fdb\u884c\u8f6c\u6362\uff0c\u5e76\u5c06\u8f6c\u6362\u540e\u7684\u6743\u91cd\u653e\u5230",(0,r.jsx)(e.code,{children:"weight_dir"}),"\u6307\u5411\u7684\u8def\u5f84\u3002"]})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"mltc_weight_dir"}),(0,r.jsxs)(e.td,{children:["\u662f",(0,r.jsx)("br",{}),"\u8bf4\u660e\uff1a\u5f53\u91c7\u7528MLTC\u7f16\u8bd1\u65b9\u5f0f\u65f6\u4e3a\u5fc5\u586b\u3002"]}),(0,r.jsx)(e.td,{children:"str"}),(0,r.jsx)(e.td,{children:"\u91c7\u7528MLTC\u7f16\u8bd1\u65b9\u5f0f\u7684\u6743\u91cd\u8def\u5f84\u3002"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"mltc_ht_file"}),(0,r.jsx)(e.td,{children:"\u5426"}),(0,r.jsx)(e.td,{children:"str"}),(0,r.jsx)(e.td,{children:"\u91c7\u7528MLTC\u7f16\u8bd1\u65b9\u5f0f\u65f6\uff0cvmfb\u6587\u4ef6\u5b58\u653e\u7684\u8def\u5f84\u3002"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"compile_args"}),(0,r.jsx)(e.td,{children:"\u5426"}),(0,r.jsx)(e.td,{children:"str"}),(0,r.jsxs)(e.td,{children:["\u91c7\u7528MLTC\u7f16\u8bd1\u65b9\u5f0f\u65f6\u4f20\u5165\u7684\u7f16\u8bd1\u53c2\u6570\uff0c\u5177\u4f53\u7f16\u8bd1\u53c2\u6570\u53ef\u53c2\u89c1",(0,r.jsx)(e.em,{children:"Python"})," ",(0,r.jsx)(e.em,{children:"API"}),"\u4e2d\u7684MLTC API\u3002"]})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"max_tasks"}),(0,r.jsx)(e.td,{children:"\u5426"}),(0,r.jsx)(e.td,{children:"int"}),(0,r.jsx)(e.td,{children:"\u652f\u6301\u540c\u65f6\u6267\u884c\u7684\u6700\u5927task\u6570\u91cf\uff0c\u6bcf\u4e2atask\u5206\u914d\u4e00\u4e2astream\u5b8c\u6210\u4e00\u8f6e\u5bf9\u8bdd\u3002\u9ed8\u8ba4\u503c\u4e3a256\u3002"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"custom_parameters"}),(0,r.jsx)(e.td,{children:"\u5426"}),(0,r.jsx)(e.td,{children:"bool"}),(0,r.jsxs)(e.td,{children:["- True\uff1a\u5141\u8bb8task\u81ea\u5b9a\u4e49temperature\u3001top_p\u3001top_k\u3001logprobs\u3001top_logprobs\u3002",(0,r.jsx)("br",{}),"- False\uff1a\u9ed8\u8ba4\u503c\u3002\u7981\u6b62task\u81ea\u5b9a\u4e49temperature\u3001top_p\u3001top_k\u3001logprobs\u3001top_logprobs\u3002"]})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"temperature"}),(0,r.jsx)(e.td,{children:"\u5426"}),(0,r.jsx)(e.td,{children:"float"}),(0,r.jsx)(e.td,{children:"\u8d85\u53c2\u6570\u4e4b\u4e00\uff0c\u63a7\u5236\u751f\u6210\u8f93\u51fa\u7684\u968f\u673a\u6027\uff0c\u503c\u8d8a\u4f4e\u4fdd\u8bc1\u66f4\u591a\u7684\u786e\u5b9a\u6027\uff0c\u503c\u8d8a\u9ad8\u5f15\u5165\u66f4\u591a\u7684\u968f\u673a\u6027\u3002\u9700\u8981\u5c06custom_parameters\u914d\u7f6e\u4e3aTrue\u624d\u53ef\u4ee5\u4fee\u6539\uff0c\u9ed8\u8ba4\u503c\u4e3a0.5\uff0c\u6570\u503c\u8303\u56f4\u4e3a[0.0, 2.0]\u3002"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"top_p"}),(0,r.jsx)(e.td,{children:"\u5426"}),(0,r.jsx)(e.td,{children:"float"}),(0,r.jsx)(e.td,{children:"\u8d85\u53c2\u6570\u4e4b\u4e00\uff0c\u5728\u751f\u6210\u8f93\u51fa\u62bd\u6837\u65f6\u6392\u9664\u7d2f\u79ef\u6982\u7387\u4f4e\u4e8e\u8be5\u503c\u7684token\u3002\u9700\u8981\u5c06custom_parameters\u914d\u7f6e\u4e3aTrue\u624d\u53ef\u4ee5\u4fee\u6539\uff0c\u9ed8\u8ba4\u503c\u4e3a0.2\uff0c\u6570\u503c\u8303\u56f4\u4e3a(0.0, 1.0]\u3002"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"top_k"}),(0,r.jsx)(e.td,{children:"\u5426"}),(0,r.jsx)(e.td,{children:"int"}),(0,r.jsx)(e.td,{children:"\u8d85\u53c2\u6570\u4e4b\u4e00\uff0c\u5728\u751f\u6210\u8f93\u51fa\u62bd\u6837\u65f6\u53ea\u5728\u6982\u7387top k\u4e2atoken\u4e2d\u8fdb\u884c\u3002\u9700\u8981\u5c06custom_parameters\u914d\u7f6e\u4e3aTrue\u624d\u53ef\u4ee5\u4fee\u6539\uff0c\u9ed8\u8ba4\u503c\u4e3a20\uff0c\u6570\u503c\u8303\u56f4\u4e3a[1, \u8bcd\u8868\u957f\u5ea6]\u3002"})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"quant_type"}),(0,r.jsx)(e.td,{children:"\u5426"}),(0,r.jsx)(e.td,{children:"str"}),(0,r.jsxs)(e.td,{children:["\u6307\u5b9a\u662f\u5426\u901a\u8fc7\u91cf\u5316\u8282\u7701\u5185\u5b58\u7a7a\u95f4\u3002",(0,r.jsx)("br",{}),"- fp16\uff1a\u9ed8\u8ba4\u503c\uff0c\u4e0d\u542f\u7528\u538b\u7f29\u3002",(0,r.jsx)("br",{}),"- w8a8\uff1a\u542f\u7528\u91cf\u5316\u3002",(0,r.jsx)("br",{}),"- w8a16\uff1a\u542f\u7528\u538b\u7f29\u3002"]})]}),(0,r.jsxs)(e.tr,{children:[(0,r.jsx)(e.td,{children:"compress_factor"}),(0,r.jsx)(e.td,{children:"\u5426"}),(0,r.jsx)(e.td,{children:"int"}),(0,r.jsxs)(e.td,{children:["\u538b\u7f29\u500d\u6570\uff0c\u4ec5\u5728",(0,r.jsx)(e.code,{children:"quant_type"}),"\u4e3a",(0,r.jsx)(e.code,{children:"w8a16"}),"\u65f6\u751f\u6548\uff0c\u652f\u6301\u7684\u538b\u7f29\u500d\u6570\u5305\u62ec128\u300164\u300132\u300116\u30018\u30011\u3001-1\uff0c\u538b\u7f29\u500d\u6570\u8d8a\u9ad8\uff0c\u80fd\u8282\u7701\u7684\u5185\u5b58\u7a7a\u95f4\u8d8a\u591a\u3002\u538b\u7f29\u500d\u6570\u4e3a-1\u65f6\u5bf9\u5e94per-channel\u65b9\u5f0f\u3002"]})]})]})]}),"\n",(0,r.jsx)(e.h3,{id:"\u95ee\u9898\u6392\u67e5",children:"\u95ee\u9898\u6392\u67e5"}),"\n",(0,r.jsx)(e.h4,{id:"\u672a\u8bbe\u7f6erisc-v\u73af\u5883\u53d8\u91cf",children:"\u672a\u8bbe\u7f6eRISC-V\u73af\u5883\u53d8\u91cf"}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsxs)(e.p,{children:["\u95ee\u9898\u73b0\u8c61\uff1a\u6267\u884c\u811a\u672c\u793a\u4f8b\u65f6\u62a5\u9519",(0,r.jsx)(e.code,{children:'RuntimeError("Can\'t find RISCV environment variable")'}),"\u3002"]}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsx)(e.p,{children:"\u89e3\u51b3\u65b9\u5f0f\uff1a\u5fc5\u987b\u8bbe\u7f6eRISC-V\u73af\u5883\u53d8\u91cf\u3002"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-bash",children:"$ export RISCV=/usr/local/hpe\n"})}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(e.h4,{id:"\u53ef\u7528\u5185\u5b58\u4e0d\u8db3",children:"\u53ef\u7528\u5185\u5b58\u4e0d\u8db3"}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsxs)(e.p,{children:["\u95ee\u9898\u73b0\u8c61\uff1a\u6267\u884c\u811a\u672c\u793a\u4f8b\u65f6\u62a5\u9519",(0,r.jsx)(e.code,{children:"run weight convert ... Killed"}),"\u3002"]}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsx)(e.p,{children:"\u89e3\u51b3\u65b9\u5f0f\uff1a\u67e5\u770b\u53ef\u7528\u5185\u5b58\u662f\u5426\u8db3\u4ee5\u653e\u4e0b\u6a21\u578b\u3001\u6743\u91cd\u7b49\u6587\u4ef6\u3002"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-bash",children:"$ free -h\n"})}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(e.h2,{id:"\u6295\u673a\u91c7\u6837\u793a\u4f8b",children:"\u6295\u673a\u91c7\u6837\u793a\u4f8b"}),"\n",(0,r.jsxs)(e.ol,{children:["\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsxs)(e.p,{children:["\u4eceHuggingFace\u7b49\u6e20\u9053\u83b7\u53d6",(0,r.jsx)(e.a,{href:"https://huggingface.co/Qwen/Qwen2-7B-Instruct",children:"Qwen2-7B-Instruct"}),"\u548cQwen2-0.5B-Instruct\u6587\u4ef6\uff0c\u5305\u62ec\u6a21\u578b\u6587\u4ef6\u3001\u6743\u91cd\u6587\u4ef6\u3001\u5206\u8bcd\u5668\u6587\u4ef6\u3001\u8bcd\u8868\u7b49\uff0c\u5e76\u590d\u5236\u5230\u76ee\u6807\u670d\u52a1\u5668\u3002"]}),"\n",(0,r.jsx)(e.p,{children:(0,r.jsx)(e.img,{src:s(8788).A+"",width:"1280",height:"694"})}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsx)(e.p,{children:"\u7f16\u5199Python\u811a\u672c\u90e8\u7f72\u5e76\u9a8c\u8bc1\u6a21\u578b\u3002\u811a\u672c\u793a\u4f8b\u4e2d\u4e3b\u8981\u5305\u62ec\u4ee5\u4e0b\u6b65\u9aa4\uff1a"}),"\n",(0,r.jsxs)(e.ol,{children:["\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsxs)(e.p,{children:["\u5206\u522b\u51c6\u5907\u5927\u5c0f\u6a21\u578b\u914d\u7f6e\uff0c\u652f\u6301\u7684\u914d\u7f6e\u9879\u8bf7\u53c2\u89c1",(0,r.jsx)(e.em,{children:"\u6a21\u578b\u914d\u7f6e"}),"\u7ae0\u8282\u3002"]}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsxs)(e.p,{children:["\u8c03\u7528",(0,r.jsx)(e.code,{children:"ManualAsyncGeneration"}),"\u63a5\u53e3\u90e8\u7f72\u6a21\u578b\u3002"]}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsx)(e.p,{children:"\u53d1\u9001messages\u9a8c\u8bc1LLM\u7684\u5bf9\u8bdd\u6548\u679c\u3002"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-bash",children:"$ cat test_speculative_decoding.py\n\nimport asyncio\nimport os\nfrom stc_llm_dnn.runtime import ManualAsyncGeneration\n\n\n\nasync def print_stream(gen, tokenizer, gen_name, prompt):\n    async for aa in gen:\n        print(\"[{}] prompt = {}, gen = {}\".format(gen_name, prompt, tokenizer.decode(aa)))\n\n\nasync def test_async_generation():\n    \n    # \u914d\u7f6e\u4fe1\u606f\n    config = {\n        \"model_name\": \"Qwen/Qwen2-7B-Instruct\", \n        \"tok_dir\": \"./qwen2-7b-instruct/Qwen2-7B-Instruct/\",\n        \"original_weight_dir\": \"./qwen2-7b-instruct/Qwen2-7B-Instruct\", \n        \"weight_dir\": \"./qwen2-7b-instruct/Qwen2-7B-Instruct/2npu\", \n        \"devices\": [0,1],\n        \"engine_dir\": \"./tmp_engine1\",\n        \"embed_on_host\": False,\n        \"output_on_host\": False,\n        \"slot_number_per_segment\": 256,\n        \"max_output_len\": 25600,\n        \"max_tasks\": 256,\n        \"custom_parameters\": True,\n    }\n    async_generation = ManualAsyncGeneration(config)\n\n    assistant_config = {\n        \"model_name\": \"Qwen/Qwen2-0.5B-Instruct\",\n        \"tok_dir\": \"./qwen2-0.5b-instruct-weight/Qwen2-0.5B-Instruct/\",\n        \"original_weight_dir\": \"./qwen2-0.5b-instruct/Qwen2-0.5B-Instruct\",\n        \"weight_dir\": \"./qwen2-0.5b-instruct/Qwen2-0.5B-Instruct/1npu\",\n        \"devices\": [2],\n        \"engine_dir\": \"./tmp_engine2\",\n        \"embed_on_host\": False,\n        \"output_on_host\": False,\n        \"slot_number_per_segment\": 256,\n        \"max_output_len\": 25600,\n        \"max_tasks\": 256,\n        \"custom_parameters\": True\n    }\n    assistant_generation = ManualAsyncGeneration(assistant_config)\n\n    messages_easy_test = [\n        {\"role\": \"user\", \"content\": \"\u4ecb\u7ecd\u4e00\u4e0b\u81ea\u5df1\"},\n    ]\n\n    user_tasks = []\n    for i in range(1):  \n        task_id, gen = await async_generation.generate(\n            messages = messages_easy_test,\n            temperature=0.5,\n            top_p=0.2,\n            top_k=1,\n            max_output_len=1024,\n            assistant_generation=assistant_generation,\n            assistant_len = 3,\n        )\n        \n        user_task = asyncio.create_task(print_stream(gen, async_generation.tokenizer, f\"gen{i}\", messages_easy_test))\n        user_tasks.append(user_task)\n\n    for user_task in user_tasks:\n        await user_task\n\n    await async_generation.shutdown()\n\n\nif __name__ == \"__main__\":\n    asyncio.run(test_async_generation()) \n\n$ python3 test_chatglm3-6b.py\n---------------------------- Model Info Begin ----------------------------\nmodel name: Qwen/Qwen2-7B-Instruct\nnpus: [0, 1]\ntotal slot number: 122082\nslot number per segment: 256\ntotal segment number: 476\nbytes per slot: 14336\ntemporary cpp dir: ./tmp_engine1\nweight dir: ./qwen2-7b-instruct/Qwen2-7B-Instruct/2npu\nembedding on host: False\noutput on host: False\ndma preload: True\nmax sequence length: 131072\ncompress_factor: 1\nquant_type: fp16\n---------------------------- Model Info End ----------------------------\nSpecial tokens have been added in the vocabulary, make sure the associated word embeddings are fine-tuned or trained.\n---------------------------- Model Info Begin ----------------------------\nmodel name: Qwen/Qwen2-0.5B-Instruct\nnpus: [2]\ntotal slot number: 488260\nslot number per segment: 256\ntotal segment number: 1907\nbytes per slot: 6144\ntemporary cpp dir: ./tmp_engine2\nweight dir: ./qwen2-0.5b-instruct/Qwen2-0.5B-Instruct/1npu\nembedding on host: False\noutput on host: False\ndma preload: True\nmax sequence length: 32768\ncompress_factor: 1\nquant_type: fp16\n---------------------------- Model Info End ----------------------------\nSpecial tokens have been added in the vocabulary, make sure the associated word embeddings are fine-tuned or trained.\n[gen0] prompt = [{'role': 'user', 'content': '\u4ecb\u7ecd\u4e00\u4e0b\u81ea\u5df1'}], gen =\n[gen0] prompt = [{'role': 'user', 'content': '\u4ecb\u7ecd\u4e00\u4e0b\u81ea\u5df1'}], gen = \u4f60\u597d\uff01\n[gen0] prompt = [{'role': 'user', 'content': '\u4ecb\u7ecd\u4e00\u4e0b\u81ea\u5df1'}], gen = \u6211\u662f\u4e00\u4e2a\n[gen0] prompt = [{'role': 'user', 'content': '\u4ecb\u7ecd\u4e00\u4e0b\u81ea\u5df1'}], gen = \u5927\u6a21\u578b\uff0c\n[gen0] prompt = [{'role': 'user', 'content': '\u4ecb\u7ecd\u4e00\u4e0b\u81ea\u5df1'}], gen = \u5168\u540d\u53eb\n[gen0] prompt = [{'role': 'user', 'content': '\u4ecb\u7ecd\u4e00\u4e0b\u81ea\u5df1'}], gen = \u901a\u4e49\u5343\u95ee\n[gen0] prompt = [{'role': 'user', 'content': '\u4ecb\u7ecd\u4e00\u4e0b\u81ea\u5df1'}], gen = \u3002\n[gen0] prompt = [{'role': 'user', 'content': '\u4ecb\u7ecd\u4e00\u4e0b\u81ea\u5df1'}], gen = \u4f5c\u4e3a\u4e00\u4e2aAI\u52a9\u624b\uff0c\n[gen0] prompt = [{'role': 'user', 'content': '\u4ecb\u7ecd\u4e00\u4e0b\u81ea\u5df1'}], gen = \u6211\u7684\n[gen0] prompt = [{'role': 'user', 'content': '\u4ecb\u7ecd\u4e00\u4e0b\u81ea\u5df1'}], gen = \u4e3b\u8981\n[gen0] prompt = [{'role': 'user', 'content': '\u4ecb\u7ecd\u4e00\u4e0b\u81ea\u5df1'}], gen = \u529f\u80fd\u662f\n[gen0] prompt = [{'role': 'user', 'content': '\u4ecb\u7ecd\u4e00\u4e0b\u81ea\u5df1'}], gen = \u5e2e\u52a9\u7528\u6237\n[gen0] prompt = [{'role': 'user', 'content': '\u4ecb\u7ecd\u4e00\u4e0b\u81ea\u5df1'}], gen = \u89e3\u7b54\u95ee\u9898\u3001\u63d0\u4f9b\n[gen0] prompt = [{'role': 'user', 'content': '\u4ecb\u7ecd\u4e00\u4e0b\u81ea\u5df1'}], gen = \u4fe1\u606f\u3001\n[gen0] prompt = [{'role': 'user', 'content': '\u4ecb\u7ecd\u4e00\u4e0b\u81ea\u5df1'}], gen = \u8fdb\u884c\n[gen0] prompt = [{'role': 'user', 'content': '\u4ecb\u7ecd\u4e00\u4e0b\u81ea\u5df1'}], gen = \u5bf9\u8bdd\n[gen0] prompt = [{'role': 'user', 'content': '\u4ecb\u7ecd\u4e00\u4e0b\u81ea\u5df1'}], gen = \u7b49\u3002\u6211\u88ab\n[gen0] prompt = [{'role': 'user', 'content': '\u4ecb\u7ecd\u4e00\u4e0b\u81ea\u5df1'}], gen = \u8bad\u7ec3\n[gen0] prompt = [{'role': 'user', 'content': '\u4ecb\u7ecd\u4e00\u4e0b\u81ea\u5df1'}], gen = \u4e86\n[gen0] prompt = [{'role': 'user', 'content': '\u4ecb\u7ecd\u4e00\u4e0b\u81ea\u5df1'}], gen = \u5728\n[gen0] prompt = [{'role': 'user', 'content': '\u4ecb\u7ecd\u4e00\u4e0b\u81ea\u5df1'}], gen = \u5404\u79cd\n[gen0] prompt = [{'role': 'user', 'content': '\u4ecb\u7ecd\u4e00\u4e0b\u81ea\u5df1'}], gen = \u4e3b\u9898\u4e0a\u63d0\u4f9b\n[gen0] prompt = [{'role': 'user', 'content': '\u4ecb\u7ecd\u4e00\u4e0b\u81ea\u5df1'}], gen = \u77e5\u8bc6\u548c\n[gen0] prompt = [{'role': 'user', 'content': '\u4ecb\u7ecd\u4e00\u4e0b\u81ea\u5df1'}], gen = \u89c1\u89e3\uff0c\u5305\u62ec\u4f46\u4e0d\u9650\u4e8e\n[gen0] prompt = [{'role': 'user', 'content': '\u4ecb\u7ecd\u4e00\u4e0b\u81ea\u5df1'}], gen = \u79d1\u6280\u3001\n[gen0] prompt = [{'role': 'user', 'content': '\u4ecb\u7ecd\u4e00\u4e0b\u81ea\u5df1'}], gen = \u6587\u5316\u3001\u5386\u53f2\u3001\n[gen0] prompt = [{'role': 'user', 'content': '\u4ecb\u7ecd\u4e00\u4e0b\u81ea\u5df1'}], gen = \u6559\u80b2\u3001\u751f\u6d3b\n[gen0] prompt = [{'role': 'user', 'content': '\u4ecb\u7ecd\u4e00\u4e0b\u81ea\u5df1'}], gen = \u7b49\u9886\u57df\u3002\n[gen0] prompt = [{'role': 'user', 'content': '\u4ecb\u7ecd\u4e00\u4e0b\u81ea\u5df1'}], gen = \u65e0\u8bba\n[gen0] prompt = [{'role': 'user', 'content': '\u4ecb\u7ecd\u4e00\u4e0b\u81ea\u5df1'}], gen = \u4f60\u9700\u8981\n[gen0] prompt = [{'role': 'user', 'content': '\u4ecb\u7ecd\u4e00\u4e0b\u81ea\u5df1'}], gen = \u5b66\u4e60\u65b0\u77e5\u8bc6\u3001\n[gen0] prompt = [{'role': 'user', 'content': '\u4ecb\u7ecd\u4e00\u4e0b\u81ea\u5df1'}], gen = \u5b8c\u6210\n[gen0] prompt = [{'role': 'user', 'content': '\u4ecb\u7ecd\u4e00\u4e0b\u81ea\u5df1'}], gen = \u67d0\u4e2a\u4efb\u52a1\uff0c\u8fd8\u662f\n[gen0] prompt = [{'role': 'user', 'content': '\u4ecb\u7ecd\u4e00\u4e0b\u81ea\u5df1'}], gen = \u53ea\u662f\u60f3\n[gen0] prompt = [{'role': 'user', 'content': '\u4ecb\u7ecd\u4e00\u4e0b\u81ea\u5df1'}], gen = \u804a\u5929\n[gen0] prompt = [{'role': 'user', 'content': '\u4ecb\u7ecd\u4e00\u4e0b\u81ea\u5df1'}], gen = \u89e3\u95f7\uff0c\u6211\n[gen0] prompt = [{'role': 'user', 'content': '\u4ecb\u7ecd\u4e00\u4e0b\u81ea\u5df1'}], gen = \u90fd\u4f1a\n[gen0] prompt = [{'role': 'user', 'content': '\u4ecb\u7ecd\u4e00\u4e0b\u81ea\u5df1'}], gen = \u5c3d\u529b\u63d0\u4f9b\u5e2e\u52a9\u3002\n[gen0] prompt = [{'role': 'user', 'content': '\u4ecb\u7ecd\u4e00\u4e0b\u81ea\u5df1'}], gen = \u8bf7\u968f\u65f6\n[gen0] prompt = [{'role': 'user', 'content': '\u4ecb\u7ecd\u4e00\u4e0b\u81ea\u5df1'}], gen = \u5411\u6211\u63d0\u95ee\uff0c\n[gen0] prompt = [{'role': 'user', 'content': '\u4ecb\u7ecd\u4e00\u4e0b\u81ea\u5df1'}], gen = \u6211\u4f1a\u5c3d\u529b\n[gen0] prompt = [{'role': 'user', 'content': '\u4ecb\u7ecd\u4e00\u4e0b\u81ea\u5df1'}], gen = \u7ed9\u51fa\n[gen0] prompt = [{'role': 'user', 'content': '\u4ecb\u7ecd\u4e00\u4e0b\u81ea\u5df1'}], gen = \u51c6\u786e\n[gen0] prompt = [{'role': 'user', 'content': '\u4ecb\u7ecd\u4e00\u4e0b\u81ea\u5df1'}], gen = \u3001\u6709\u7528\n[gen0] prompt = [{'role': 'user', 'content': '\u4ecb\u7ecd\u4e00\u4e0b\u81ea\u5df1'}], gen = \u7684\u56de\u7b54\u3002\n[gen0] prompt = [{'role': 'user', 'content': '\u4ecb\u7ecd\u4e00\u4e0b\u81ea\u5df1'}], gen = \u5982\u679c\u4f60\u6709\u4efb\u4f55\n[gen0] prompt = [{'role': 'user', 'content': '\u4ecb\u7ecd\u4e00\u4e0b\u81ea\u5df1'}], gen = \u9700\u8981\n[gen0] prompt = [{'role': 'user', 'content': '\u4ecb\u7ecd\u4e00\u4e0b\u81ea\u5df1'}], gen = \u6216\u8005\n[gen0] prompt = [{'role': 'user', 'content': '\u4ecb\u7ecd\u4e00\u4e0b\u81ea\u5df1'}], gen = \u597d\u5947\u7684\u95ee\u9898\uff0c\u6b22\u8fce\n[gen0] prompt = [{'role': 'user', 'content': '\u4ecb\u7ecd\u4e00\u4e0b\u81ea\u5df1'}], gen = \u968f\u65f6\n[gen0] prompt = [{'role': 'user', 'content': '\u4ecb\u7ecd\u4e00\u4e0b\u81ea\u5df1'}], gen = \u544a\u8bc9\u6211\uff01\n[gen0] prompt = [{'role': 'user', 'content': '\u4ecb\u7ecd\u4e00\u4e0b\u81ea\u5df1'}], gen =\n"})}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(e.h3,{id:"\u95ee\u9898\u6392\u67e5-1",children:"\u95ee\u9898\u6392\u67e5"}),"\n",(0,r.jsx)(e.h4,{id:"\u53ef\u7528\u5185\u5b58\u4e0d\u8db3-1",children:"\u53ef\u7528\u5185\u5b58\u4e0d\u8db3"}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsxs)(e.p,{children:["\u95ee\u9898\u73b0\u8c61\uff1a\u6267\u884c\u811a\u672c\u793a\u4f8b\u65f6\u62a5\u9519",(0,r.jsx)(e.code,{children:"Bus error"}),"\u3002"]}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["\n",(0,r.jsxs)(e.p,{children:["\u89e3\u51b3\u65b9\u5f0f\uff1a\u4f7f\u7528",(0,r.jsx)(e.code,{children:"free -h"}),"\u67e5\u770b\u53ef\u7528\u5185\u5b58\u662f\u5426\u8db3\u4ee5\u653e\u4e0b\u6a21\u578b\u3001\u6743\u91cd\u7b49\u6587\u4ef6\u3002\u5728\u8f6c\u6362\u6743\u91cd\u65f6\u8fd8\u4f1a\u521b\u5efa\u526f\u672c\uff0c\u56e0\u6b64\u9700\u8981\u914d\u5907\u5c3d\u91cf\u5927\u7684\u5185\u5b58\uff0c\u4e5f\u53ef\u76f4\u63a5\u4f7f\u7528",(0,r.jsx)(e.code,{children:"weight_dir"}),"\u8bbe\u7f6e\u8f6c\u6362\u540e\u7684\u6743\u91cd\u3002"]}),"\n"]}),"\n"]})]})}function o(n={}){const{wrapper:e}={...(0,l.R)(),...n.components};return e?(0,r.jsx)(e,{...n,children:(0,r.jsx)(h,{...n})}):h(n)}},3264:(n,e,s)=>{s.d(e,{A:()=>t});const t=s.p+"assets/images/stc-llm-image-8-07140134febc592e08077200b8012f86.png"},3322:(n,e,s)=>{s.d(e,{A:()=>t});const t=s.p+"assets/images/stc-llm-image-17-233a6e669b8fe4569825db22e83d4a9c.png"},4083:(n,e,s)=>{s.d(e,{A:()=>t});const t=s.p+"assets/images/stc-llm-image-16-b8653820cadf6056396c2ef702ccbc51.png"},5238:(n,e,s)=>{s.d(e,{A:()=>t});const t=s.p+"assets/images/8b3a65e1-89a3-4426-b29a-0baa72f5c556-ce104fb2f80c58f8c194683673cd3f94.png"},5566:(n,e,s)=>{s.d(e,{A:()=>t});const t=s.p+"assets/images/stc-llm-image-13-d473b1f29ea70b002baf9daafdf3d69e.png"},5815:(n,e,s)=>{s.d(e,{A:()=>t});const t=s.p+"assets/images/stc-llm-image-7903d9c94553bbd81d24818d822c65fa.png"},6273:(n,e,s)=>{s.d(e,{A:()=>t});const t=s.p+"assets/images/stc-llm-image-1-2d4b4bd70ac388f727f5c0a4c22617e3.png"},7465:(n,e,s)=>{s.d(e,{A:()=>t});const t=s.p+"assets/images/stc-llm-image-9-4848b5600a30637554157fce5d3ef79f.png"},7495:(n,e,s)=>{s.d(e,{A:()=>t});const t=s.p+"assets/images/stc-llm-image-7-0cbd9a123bc1b5dd04bb5e69ce54685c.png"},7989:(n,e,s)=>{s.d(e,{A:()=>t});const t=s.p+"assets/images/stc-llm-image-10-672e85ba99b25e9ea28091de50babc3f.png"},8453:(n,e,s)=>{s.d(e,{R:()=>i,x:()=>c});var t=s(6540);const r={},l=t.createContext(r);function i(n){const e=t.useContext(l);return t.useMemo(function(){return"function"==typeof n?n(e):{...e,...n}},[e,n])}function c(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(r):n.components||r:i(n.components),t.createElement(l.Provider,{value:e},n.children)}},8788:(n,e,s)=>{s.d(e,{A:()=>t});const t=s.p+"assets/images/stc-llm-image-19-7903d9c94553bbd81d24818d822c65fa.png"},9207:(n,e,s)=>{s.d(e,{A:()=>t});const t=s.p+"assets/images/stc-llm-image-12-f1c982b23e5eed02ba6b8ae9588e53bb.png"},9592:(n,e,s)=>{s.d(e,{A:()=>t});const t=s.p+"assets/images/stc-llm-image-15-35b134636361ae4412e135f8b338be26.png"},9859:(n,e,s)=>{s.d(e,{A:()=>t});const t=s.p+"assets/images/stc-llm-image-3-c1be2a06c8ec376c0b939c244cc64a8c.png"},9917:(n,e,s)=>{s.d(e,{A:()=>t});const t=s.p+"assets/images/stc-llm-image-18-7903d9c94553bbd81d24818d822c65fa.png"}}]);